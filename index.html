<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ë§ˆìŒ ì±™ê¹€ & ê±´ê°• íŒŒíŠ¸ë„ˆ</title>
<style>
:root{
  --primary:#6366f1; --accent:#10b981; --bg:#f3f4f6; --card:#fff; --text:#1f2937; --danger:#ef4444;
}
*{box-sizing:border-box}
body{font-family:Inter, Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;margin:0;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
.app-container{max-width:480px;margin:0 auto;min-height:100vh;background:#fff;box-shadow:0 0 20px rgba(0,0,0,0.05);display:flex;flex-direction:column;position:relative}
header{background:var(--primary);color:white;padding:18px;text-align:center;border-radius:0 0 18px 18px;box-shadow:0 4px 10px rgba(99,102,241,0.2);z-index:10}
header h1{margin:0;font-size:1.15rem}
.screen{display:none;padding:18px;padding-bottom:90px;flex:1;overflow-y:auto}
.screen.active{display:block}
.card{background:var(--card);border-radius:14px;padding:16px;margin-bottom:14px;box-shadow:0 6px 18px rgba(0,0,0,0.03);border:1px solid #f0f0f0}
.action-btn{width:100%;padding:12px;background:var(--primary);color:#fff;border:none;border-radius:10px;font-weight:600;cursor:pointer}
.secondary-btn{background:#eef2ff;color:var(--primary)}
.danger-btn{background:var(--danger);color:#fff}
.bottom-nav{position:fixed;bottom:0;left:0;right:0;background:#fff;border-top:1px solid #eee;display:flex;justify-content:space-around;padding:8px 0;max-width:480px;margin:0 auto;z-index:20;display:none}
.bottom-nav.active{display:flex}
.nav-btn{border:none;background:none;display:flex;flex-direction:column;align-items:center;font-size:0.72rem;color:#6b7280;cursor:pointer}
.nav-btn span{font-size:1.4rem;margin-bottom:4px}
.nav-btn.active{color:var(--primary)}
.mood-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.mood-btn{background:#f9fafb;border:2px solid #eee;border-radius:12px;padding:10px;font-size:1.7rem;cursor:pointer}
#chatHistory{height:320px;overflow-y:auto;background:#f8fafc;border-radius:10px;padding:12px;border:1px solid #e2e8f0;display:flex;flex-direction:column;gap:8px}
.msg{max-width:80%;padding:10px 12px;border-radius:12px;font-size:0.95rem;line-height:1.4}
.msg.user{align-self:flex-end;background:var(--primary);color:white;border-bottom-right-radius:4px}
.msg.ai{align-self:flex-start;background:white;border:1px solid #e2e8f0;color:#333;border-bottom-left-radius:4px}
.hidden{display:none}
.stat-value{font-size:1.3rem;font-weight:700;color:var(--primary)}
.time-row{display:flex;gap:8px;align-items:center}
.time-row label{width:60px;font-weight:600;font-size:0.9rem}
.small{font-size:0.86rem;color:#666}
.center{text-align:center}
hr.sep{border:none;border-top:1px solid #eee;margin:12px 0}
</style>
</head>
<body>
<div class="app-container">
  <header><h1 id="headerTitle">ë§ˆìŒ ì±™ê¹€ & ê±´ê°• íŒŒíŠ¸ë„ˆ</h1></header>

  <!-- LOGIN -->
  <div id="screen-login" class="screen active">
    <div class="card center" style="margin-top:36px">
      <div style="font-size:3rem;margin-bottom:8px">ğŸ§˜</div>
      <h2>í™˜ì˜í•©ë‹ˆë‹¤</h2>
      <p class="small">ê±´ê°•í•œ ëª¸ê³¼ ë§ˆìŒì„ ìœ„í•œ ì²« ê±¸ìŒì„ ë‚˜ì•„ê°€ì„¸ìš”!</p>

      <div id="loginBox" style="margin-top:12px">
        <input id="loginId" type="text" placeholder="ì•„ì´ë””" style="width:100%;padding:10px;border-radius:8px;border:1px solid #ddd;margin-top:8px">
        <input id="loginPw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" style="width:100%;padding:10px;border-radius:8px;border:1px solid #ddd;margin-top:8px">
        <button class="action-btn" style="margin-top:10px" onclick="app.auth.login()">ë¡œê·¸ì¸</button>
        <button class="action-btn secondary-btn" style="margin-top:8px" onclick="app.ui.toggleSignup(true)">íšŒì›ê°€ì… í•˜ëŸ¬ê°€ê¸°</button>
      </div>

      <div id="signupBox" class="hidden" style="margin-top:12px">
        <input id="regId" type="text" placeholder="ì•„ì´ë”” (í•„ìˆ˜)" style="width:100%;padding:10px;border-radius:8px;border:1px solid #ddd;margin-top:8px">
        <input id="regPw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ (í•„ìˆ˜)" style="width:100%;padding:10px;border-radius:8px;border:1px solid #ddd;margin-top:8px">
        <input id="regAge" type="number" placeholder="ë‚˜ì´ (ì„ íƒ)" style="width:100%;padding:10px;border-radius:8px;border:1px solid #ddd;margin-top:8px">
        <button class="action-btn" style="margin-top:10px" onclick="app.auth.signup()">ê°€ì…í•˜ê¸°</button>
        <button class="action-btn secondary-btn" style="margin-top:8px" onclick="app.ui.toggleSignup(false)">ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
      </div>
      <p id="authMsg" class="small" style="color:var(--danger);margin-top:8px"></p>
    </div>
  </div>

  <!-- HOME -->
  <div id="screen-home" class="screen">
    <div class="card">
      <h2>ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”, <span id="userNameDisplay">ê²ŒìŠ¤íŠ¸</span>ë‹˜!</h2>
      <p id="greetingMsg" class="small">ì˜¤ëŠ˜ë„ ê±´ê°•í•œ í•˜ë£¨ ë³´ë‚´ì„¸ìš”.</p>
    </div>

    <div class="card">
      <h2>ğŸ“¢ ì˜¤ëŠ˜ì˜ í•œë§ˆë””</h2>
      <p id="dailyQuote" class="small" style="font-style:italic">"ì‘ì€ ë³€í™”ê°€ í° ê²°ê³¼ë¥¼ ë§Œë“­ë‹ˆë‹¤."</p>
    </div>

    <div class="card" id="moodCard" style="cursor:pointer" onclick="app.nav.go('mental')">
      <h2>ğŸ’— í˜„ì¬ ê¸°ë¶„</h2>
      <div id="homeMoodDisplay" class="stat-value">ê¸°ë¡ ì—†ìŒ</div>
      <p class="small">í´ë¦­í•˜ì—¬ ê¸°ë¶„ ê¸°ë¡í•˜ê¸°</p>
    </div>

    <div class="card">
      <h2>ğŸ½ ì˜¤ëŠ˜ì˜ ì¶”ì²œ ì‹ë‹¨</h2>
      <div id="homeFoodResult" style="background:#f3f4f6;padding:12px;border-radius:8px;color:var(--primary);font-weight:700">ì¶”ì²œë°›ì•„ë³´ì„¸ìš”</div>
      <div style="display:flex;gap:8px;margin-top:10px">
        <button class="action-btn" style="flex:1" onclick="app.food.recommend('#homeFoodResult')">ì¶”ì²œë°›ê¸°</button>
        <button class="action-btn secondary-btn" style="flex:1" onclick="app.food.recommend('#homeFoodResult')">ë‹¤ì‹œ</button>
      </div>
    </div>

    <button class="action-btn danger-btn" onclick="app.auth.logout()">ë¡œê·¸ì•„ì›ƒ</button>
  </div>

  <!-- MENTAL -->
  <div id="screen-mental" class="screen">
    <div class="card">
      <h2>ì§€ê¸ˆ ê¸°ë¶„ì´ ì–´ë– ì‹ ê°€ìš”?</h2>
      <p class="small">ê°ì •ì„ ì†”ì§í•˜ê²Œ í‘œí˜„í•´ë³´ì„¸ìš”.</p>
      <div class="mood-grid" style="margin-top:12px">
        <button class="mood-btn" onclick="app.mental.setMood('happy')">ğŸ˜„</button>
        <button class="mood-btn" onclick="app.mental.setMood('calm')">ğŸ˜Œ</button>
        <button class="mood-btn" onclick="app.mental.setMood('neutral')">ğŸ˜</button>
        <button class="mood-btn" onclick="app.mental.setMood('sad')">ğŸ˜¢</button>
        <button class="mood-btn" onclick="app.mental.setMood('angry')">ğŸ˜¡</button>
        <button class="mood-btn" onclick="app.mental.setMood('tired')">ğŸ˜«</button>
      </div>
    </div>
    <div id="moodResultCard" class="card hidden">
      <h2>ğŸ’¡ AIì˜ ê³µê° & ì œì•ˆ</h2>
      <p id="moodComment" style="font-size:1.02rem;color:#374151"></p>
      <p class="small" style="margin-top:8px">ê¸°ë¡ì€ ì•ˆì „í•˜ê²Œ ë¡œì»¬ì— ì €ì¥ë©ë‹ˆë‹¤.</p>
    </div>
  </div>

  <!-- SLEEP -->
  <div id="screen-sleep" class="screen">
    <div class="card">
      <h2>ğŸŒ™ ìˆ˜ë©´ ê¸°ë¡</h2>
      <div class="time-row" style="margin-top:10px">
        <label>ì·¨ì¹¨</label>
        <input id="sleepTime" type="time">
        <select id="sleepAmpm" style="padding:8px;border-radius:8px;border:1px solid #ddd">
          <option>PM</option><option>AM</option>
        </select>
      </div>
      <div class="time-row" style="margin-top:8px">
        <label>ê¸°ìƒ</label>
        <input id="wakeTime" type="time">
        <select id="wakeAmpm" style="padding:8px;border-radius:8px;border:1px solid #ddd">
          <option>AM</option><option>PM</option>
        </select>
      </div>
      <div style="margin-top:10px">
        <button class="action-btn" onclick="app.sleep.save()">ê¸°ë¡ ì €ì¥</button>
      </div>
    </div>

    <div class="card">
      <h2>ğŸ“… ìµœê·¼ ìˆ˜ë©´ ì´ë ¥</h2>
      <ul id="sleepList" style="list-style:none;padding:0;margin:0;font-size:0.9rem;color:#555">
        <li>ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</li>
      </ul>
    </div>
  </div>

  <!-- FOOD -->
  <div id="screen-food" class="screen">
    <div class="card center">
      <div style="font-size:3rem">ğŸ¥—</div>
      <h2>ì˜¤ëŠ˜ ë­ ë¨¹ì„ê¹Œìš”?</h2>
      <p class="small">ê±´ê°•í•œ ì„ íƒì„ ì¶”ì²œí•´ë“œë ¤ìš”.</p>

      <div style="background:#f3f4f6;padding:16px;border-radius:10px;margin:14px 0">
        <h3 id="foodResult" style="margin:0;color:var(--primary);font-size:1.2rem">ì¶”ì²œì„ ë°›ì•„ë³´ì„¸ìš”</h3>
      </div>

      <button class="action-btn" onclick="app.food.recommend('#foodResult')">ëœë¤ ì¶”ì²œ ë°›ê¸°</button>
      <p class="small" style="margin-top:10px">*ë°ì´í„°ë² ì´ìŠ¤ í˜•ì‹ìœ¼ë¡œ 5,000ê°œ ì´ìƒì˜ ê±´ê°•ì‹ ìƒì„±(í´ë¼ì´ì–¸íŠ¸ ì‹œë®¬ë ˆì´ì…˜)</p>
    </div>
  </div>

  <!-- GAME -->
  <div id="screen-game" class="screen">
    <div class="card">
      <h2>ğŸ§  ê±´ê°• ìƒì‹ í€´ì¦ˆ</h2>
      <div style="margin:16px 0">
        <p id="gameQuestion" style="font-weight:bold;font-size:1.02rem;margin-bottom:8px">ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        <input id="gameAnswer" type="text" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”" style="width:100%;padding:10px;border-radius:8px;border:1px solid #ddd">
      </div>
      <div style="display:flex;gap:8px">
        <button class="action-btn" style="flex:1" onclick="app.game.check()">ì •ë‹µ í™•ì¸</button>
        <button class="action-btn secondary-btn" style="flex:1" onclick="app.game.next()">ë‹¤ìŒ ë¬¸ì œ</button>
      </div>
      <div id="gameFeedback" style="margin-top:12px;font-weight:700"></div>
      <div style="margin-top:10px" class="small">ë¬¸ì œëŠ” ë³€í˜• ìƒì„±í•˜ì—¬ 500ê°œ ì´ìƒ ì œê³µë©ë‹ˆë‹¤.</div>
    </div>
  </div>

  <!-- CHAT -->
  <div id="screen-chat" class="screen">
    <div class="card" style="height:calc(100vh - 210px);display:flex;flex-direction:column">
      <h2 style="flex-shrink:0">ğŸ¤– AI ìƒë‹´ì‚¬</h2>
      <div id="chatHistory" style="flex:1">
        <div class="msg ai">ì•ˆë…•í•˜ì„¸ìš”! ì˜¤ëŠ˜ í•˜ë£¨ëŠ” ì–´ë– ì…¨ë‚˜ìš”? í¸í•˜ê²Œ ì´ì•¼ê¸°í•´ ì£¼ì„¸ìš”.</div>
      </div>
      <div style="display:flex;gap:8px;margin-top:10px;flex-shrink:0">
        <input id="chatInput" type="text" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." style="flex:1;padding:10px;border-radius:8px;border:1px solid #ddd" onkeypress="if(event.key==='Enter') app.chat.send()">
        <button class="action-btn" style="width:64px" onclick="app.chat.send()">â¤</button>
      </div>
    </div>
  </div>

  <nav id="bottomNav" class="bottom-nav">
    <button class="nav-btn" data-screen="home" onclick="app.nav.go('home')"><span>ğŸ </span>í™ˆ</button>
    <button class="nav-btn" data-screen="mental" onclick="app.nav.go('mental')"><span>ğŸ’•</span>ë©˜íƒˆ</button>
    <button class="nav-btn" data-screen="sleep" onclick="app.nav.go('sleep')"><span>ğŸŒ™</span>ìˆ˜ë©´</button>
    <button class="nav-btn" data-screen="food" onclick="app.nav.go('food')"><span>ğŸ¥—</span>ìŒì‹</button>
    <button class="nav-btn" data-screen="game" onclick="app.nav.go('game')"><span>ğŸ®</span>ê²Œì„</button>
    <button class="nav-btn" data-screen="chat" onclick="app.nav.go('chat')"><span>ğŸ’¬</span>ìƒë‹´</button>
  </nav>
</div>

<script>
/*
  í†µí•© ì•± ìŠ¤í¬ë¦½íŠ¸
  - ëŒ€ìš©ëŸ‰ ë°ì´í„°ëŠ” ëŸ°íƒ€ì„ ìƒì„±(í…œí”Œë¦¿ ê¸°ë°˜)ìœ¼ë¡œ í˜ì´ì§€ ì†ŒìŠ¤ ê°€ë…ì„± ìœ ì§€
  - ìš”êµ¬: foods >= 5000, ai keywords >= 2000, games >= 500
*/

const DATA = {
  foods: [],
  aiKeywordsByCategory: {}, // category -> [keywords...]
  aiResponses: {}, // category -> {empathy, solution}
  games: []
};

const app = {
  state: {
    user: null,
    currentGame: null
  },

  init: function(){
    // ë°ì´í„° ìƒì„± (í•„ìš” ê°œìˆ˜ ìƒì„±)
    this.dataGenerator.initAll({foods:5000, aiKeywords:2200, games:600});
    // UI setup
    this.auth.checkSession();
    this.game.next();
    this.setupNavActiveBehavior();
    // greet quote rotate
    this.setDailyQuote();
  },

  // ---------- ì¸ì¦ ----------
  auth: {
    getUsers: ()=> JSON.parse(localStorage.getItem('app_users')||'{}'),
    saveUsers: users => localStorage.setItem('app_users', JSON.stringify(users)),

    signup: function(){
      const id = document.getElementById('regId').value.trim();
      const pw = document.getElementById('regPw').value.trim();
      const age = document.getElementById('regAge').value.trim();
      const msgEl = document.getElementById('authMsg');
      msgEl.textContent = '';

      if(!id || !pw){ msgEl.textContent = 'ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'; return; }
      const users = app.auth.getUsers();
      if(users[id]){ msgEl.textContent = 'ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.'; return; }
      users[id] = { pw, age: age||null, joinDate: new Date().toISOString() };
      app.auth.saveUsers(users);
      alert('íšŒì›ê°€ì… ì™„ë£Œ! ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.');
      app.ui.toggleSignup(false);
      document.getElementById('regId').value=''; document.getElementById('regPw').value=''; document.getElementById('regAge').value='';
    },

    login: function(){
      const id = document.getElementById('loginId').value.trim();
      const pw = document.getElementById('loginPw').value.trim();
      const users = app.auth.getUsers();
      const msgEl = document.getElementById('authMsg');
      msgEl.textContent = '';

      if(users[id] && users[id].pw === pw){
        app.state.user = { id, ...users[id] };
        localStorage.setItem('app_current_user', JSON.stringify(app.state.user));
        app.ui.onLoginSuccess();
      } else {
        msgEl.textContent = 'ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.';
      }
    },

    logout: function(){
      if(!confirm('ì •ë§ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      app.state.user = null;
      localStorage.removeItem('app_current_user');
      // optional: clear UI state
      location.reload();
    },

    checkSession: function(){
      const saved = localStorage.getItem('app_current_user');
      if(saved){
        app.state.user = JSON.parse(saved);
        app.ui.onLoginSuccess();
      } else {
        // stay at login screen
        app.nav.go('login');
      }
    }
  },

  // ---------- UI ----------
  ui: {
    toggleSignup: function(show){
      document.getElementById('loginBox').classList.toggle('hidden', show);
      document.getElementById('signupBox').classList.toggle('hidden', !show);
      document.getElementById('authMsg').textContent = '';
    },
    onLoginSuccess: function(){
      document.getElementById('userNameDisplay').textContent = app.state.user.id;
      document.getElementById('bottomNav').classList.add('active');
      app.sleep.load();
      // load mood if exists
      const m = localStorage.getItem(`mood_${app.state.user.id}`);
      if(m) document.getElementById('homeMoodDisplay').textContent = (app.mental.moodIcons[m]||'') + ' ' + (m.toUpperCase());
      app.nav.go('home');
    }
  },

  // ---------- NAV ----------
  nav: {
    go: function(screenId){
      // Restrict screens except login if not authenticated
      if(screenId !== 'login' && !app.state.user){
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        return app.nav.go('login');
      }
      // map to element ID pattern: screen-<id>
      const allScreens = document.querySelectorAll('.screen');
      allScreens.forEach(s => s.classList.remove('active'));
      const target = document.getElementById('screen-' + screenId);
      if(target) target.classList.add('active');
      // header title
      const titles = { home:'í™ˆ', mental:'ë©˜íƒˆ ì¼€ì–´', sleep:'ìˆ˜ë©´ ê¸°ë¡', food:'ê±´ê°• ì‹ë‹¨', game:'ë¯¸ë‹ˆ ê²Œì„', chat:'AI ìƒë‹´', login: 'ë§ˆìŒ ì±™ê¹€ & ê±´ê°• íŒŒíŠ¸ë„ˆ' };
      document.getElementById('headerTitle').textContent = titles[screenId] || 'ê±´ê°• ê´€ë¦¬ ì•±';
      // highlight bottom nav
      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
      const btn = document.querySelector(`.nav-btn[data-screen="${screenId}"]`);
      if(btn) btn.classList.add('active');
    }
  },

  // ---------- ë©˜íƒˆ ----------
  mental: {
    moodIcons: { happy:'ğŸ˜„', calm:'ğŸ˜Œ', neutral:'ğŸ˜', sad:'ğŸ˜¢', angry:'ğŸ˜¡', tired:'ğŸ˜«' },
    setMood: function(mood){
      // pick a positive random comment (ensured by dataset)
      const comments = {
        happy:["ê¸ì • ì—ë„ˆì§€ê°€ ë„˜ì¹˜ë„¤ìš”! ì´ ê¸°ë¶„ì„ ì£¼ë³€ì—ë„ ë‚˜ëˆ ë³´ì„¸ìš” âœ¨","ì˜¤ëŠ˜ì´ ì°¸ ì¢‹ì€ ë‚ ì´ë„¤ìš”! ê³„ì† ì›ƒì–´ìš” ğŸ™‚"],
        calm:["í‰ì˜¨í•¨ì€ í° ì„ ë¬¼ì…ë‹ˆë‹¤. ê¹Šê²Œ ìˆ¨ ì‰¬ì–´ë³´ì„¸ìš”. ğŸ˜Œ","ì°¨ë¶„í•œ ë§ˆìŒìœ¼ë¡œ ì˜¤ëŠ˜ ê³„íšì„ ì°¨ê·¼ì°¨ê·¼ í•´ë³´ì„¸ìš”."],
        neutral:["ë¬´ë‚œí•œ í•˜ë£¨ë„ ì†Œì¤‘í•©ë‹ˆë‹¤. ê°€ë²¼ìš´ ì‚°ì±…ì„ ì¶”ì²œí•´ìš”.","ì˜¤ëŠ˜ì˜ ì‘ì€ ì„±ì·¨ í•˜ë‚˜ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”."],
        sad:["ê´œì°®ì•„ìš”. í˜¼ìê°€ ì•„ë‹ˆì—ìš”. ì‘ì€ ì‚°ì±…ì´ë‚˜ ë”°ëœ»í•œ ì°¨ ì–´ë– ì„¸ìš”?","ìš¸ê³  ì‹¶ìœ¼ë©´ ìš¸ì–´ë„ ì¢‹ì•„ìš”. ê°ì • í‘œí˜„ì€ ì¹˜ìœ ì˜ ì‹œì‘ì…ë‹ˆë‹¤."],
        angry:["í™”ê°€ ê°€ì‹¤ ë•ŒëŠ” ì ì‹œ ë©ˆì¶”ê³  3ë²ˆ ê¹Šê²Œ ìˆ¨ ì‰¬ì–´ë³´ì„¸ìš”.","í•œ ê±¸ìŒ ë–¨ì–´ì ¸ ìƒí™©ì„ ë°”ë¼ë³´ë©´ ë„ì›€ì´ ë©ë‹ˆë‹¤."],
        tired:["ì ê¹ì˜ ë‚®ì (15-20ë¶„)ì´ ë†€ë¼ìš´ íšŒë³µì„ ì¤ë‹ˆë‹¤.","ìˆ˜ë¶„ ì„­ì·¨ì™€ ê°€ë²¼ìš´ ìŠ¤íŠ¸ë ˆì¹­ì„ ì¶”ì²œí•´ìš”."]
      };
      const msg = comments[mood] ? comments[mood][Math.floor(Math.random()*comments[mood].length)] : "ì§€ê¸ˆì˜ ê°ì •ì„ ì˜ ì‚´í´ë³´ì„¸ìš”.";
      document.getElementById('moodResultCard').classList.remove('hidden');
      document.getElementById('moodComment').innerHTML = `<strong>${msg}</strong>`;
      // save mood with date (append)
      if(app.state.user){
        const key = `mood_history_${app.state.user.id}`;
        const hist = JSON.parse(localStorage.getItem(key) || '[]');
        hist.unshift({ date: new Date().toISOString(), mood });
        if(hist.length>30) hist.pop();
        localStorage.setItem(key, JSON.stringify(hist));
        // quick current mood cache
        localStorage.setItem(`mood_${app.state.user.id}`, mood);
        document.getElementById('homeMoodDisplay').textContent = this.moodIcons[mood] + ' ' + mood.toUpperCase();
      }
    }
  },

  // ---------- ìˆ˜ë©´ ----------
  sleep: {
    save: function(){
      const sTime = document.getElementById('sleepTime').value;
      const sAmpm = document.getElementById('sleepAmpm').value;
      const wTime = document.getElementById('wakeTime').value;
      const wAmpm = document.getElementById('wakeAmpm').value;
      if(!sTime || !wTime){ alert('ì‹œê°„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
      if(!app.state.user){ alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'); return; }

      // convert to Date objects for rough duration calculation
      const to24 = (t, ampm) => {
        const [hh,mm] = t.split(':').map(Number);
        let H = hh;
        if(ampm === 'PM' && hh < 12) H = hh + 12;
        if(ampm === 'AM' && hh === 12) H = 0;
        return {H,mm};
      };
      const s = to24(sTime, sAmpm);
      const w = to24(wTime, wAmpm);
      // create moment-like minutes since midnight
      const startMin = s.H*60 + s.mm;
      const endMin = w.H*60 + w.mm;
      // allow overnight
      let durationMin = endMin - startMin;
      if(durationMin <= 0) durationMin += 24*60;
      const hours = Math.floor(durationMin/60);
      const mins = durationMin % 60;

      const log = {
        date: new Date().toLocaleDateString(),
        start: `${sTime} ${sAmpm}`,
        end: `${wTime} ${wAmpm}`,
        duration: `${hours}ì‹œê°„ ${mins}ë¶„`
      };

      const key = `sleep_${app.state.user.id}`;
      const logs = JSON.parse(localStorage.getItem(key) || '[]');
      logs.unshift(log);
      if(logs.length>10) logs.pop();
      localStorage.setItem(key, JSON.stringify(logs));
      this.renderLogs(logs);
      alert('ìˆ˜ë©´ ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤ ğŸŒ™');
    },
    load: function(){
      if(!app.state.user) return;
      const key = `sleep_${app.state.user.id}`;
      const logs = JSON.parse(localStorage.getItem(key) || '[]');
      this.renderLogs(logs);
    },
    renderLogs: function(logs){
      const list = document.getElementById('sleepList');
      if(!logs || logs.length===0){ list.innerHTML = '<li>ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</li>'; return; }
      list.innerHTML = logs.map(l => `<li style="padding:10px;border-bottom:1px solid #eee">
        <div style="font-weight:700;color:var(--primary)">${l.date}</div>
        <div class="small">ğŸ›Œ ${l.start} ~ â˜€ ${l.end} Â· ${l.duration}</div>
      </li>`).join('');
    }
  },

  // ---------- ìŒì‹ ì¶”ì²œ ----------
  food: {
    recommend: function(targetSelector = '#foodResult'){
      // robust random pick
      const idx = Math.floor(Math.random() * DATA.foods.length);
      const pick = DATA.foods[idx];
      const el = document.querySelector(targetSelector);
      if(!el) return;
      el.style.opacity = 0;
      setTimeout(()=>{ el.textContent = pick; el.style.opacity = 1; }, 180);
    }
  },

  // ---------- ê²Œì„ ----------
  game: {
    next: function(){
      if(DATA.games.length === 0) return;
      app.state.currentGame = DATA.games[Math.floor(Math.random()*DATA.games.length)];
      document.getElementById('gameQuestion').textContent = "Q. " + app.state.currentGame.q;
      document.getElementById('gameAnswer').value = '';
      document.getElementById('gameFeedback').textContent = '';
    },
    check: function(){
      const input = (document.getElementById('gameAnswer').value || '').trim();
      const answers = app.state.currentGame && app.state.currentGame.a ? app.state.currentGame.a.map(x=>x.toString().toLowerCase()) : [];
      const feedback = document.getElementById('gameFeedback');
      if(!app.state.currentGame){ feedback.textContent = 'ë¬¸ì œë¥¼ ë¨¼ì € ë¶ˆëŸ¬ì˜¤ì„¸ìš”.'; return; }
      if(answers.includes(input.toLowerCase())){
        feedback.textContent = "âœ… ì •ë‹µì…ë‹ˆë‹¤! ê±´ê°• ì§€ì‹ +1";
        feedback.style.color = "var(--accent)";
      } else {
        feedback.textContent = `âŒ ì˜¤ë‹µì…ë‹ˆë‹¤. ì •ë‹µì€ '${app.state.currentGame.a[0]}' ì…ë‹ˆë‹¤.`;
        feedback.style.color = "var(--danger)";
      }
    }
  },

  // ---------- AI ìƒë‹´ ----------
  chat: {
    send: function(){
      const el = document.getElementById('chatInput');
      const msg = (el.value || '').trim();
      if(!msg) return;
      this.addMsg(msg, 'user');
      el.value = '';
      setTimeout(()=>{
        const reply = this.getAIResponse(msg);
        this.addMsg(reply, 'ai');
      }, 400);
    },
    addMsg: function(text, type){
      const div = document.createElement('div');
      div.className = `msg ${type}`;
      div.textContent = text;
      const box = document.getElementById('chatHistory');
      box.appendChild(div);
      box.scrollTop = box.scrollHeight;
    },
    getAIResponse: function(userMsg){
      const txt = userMsg.toLowerCase();
      // 1) keyword category match (longest match approach)
      const matches = [];
      for(const cat in DATA.aiKeywordsByCategory){
        const kws = DATA.aiKeywordsByCategory[cat];
        // performance: use some()
        if(kws.some(k => txt.includes(k))) matches.push(cat);
      }
      // pick highest priority if multiple
      const priority = ['suicide','stress','depression','insomnia','hunger','fatigue','greeting','general'];
      const found = priority.find(p => matches.includes(p));
      let empathy = '';
      let solution = '';

      if(found){
        const resp = DATA.aiResponses[found];
        empathy = resp.empathy;
        solution = resp.solution;
      } else {
        // context-based fallback using latest mood
        if(app.state.user){
          const currentMood = localStorage.getItem(`mood_${app.state.user.id}`);
          if(currentMood === 'sad' || currentMood === 'tired') {
            empathy = "ì§€ê¸ˆ ê¸°ë¶„ì´ ì¢‹ì§€ ì•Šìœ¼ì‹  ê²ƒ ê°™ì•„ ê±±ì •ë¼ìš”.";
            solution = "ê´œì°®ìœ¼ì‹œë‹¤ë©´ ì–´ë–¤ ì¼ ë•Œë¬¸ì— ê·¸ëŸ¬ì‹ ì§€ ì²œì²œíˆ ì´ì•¼ê¸°í•´ ì£¼ì‹¤ë˜ìš”? ê°„ë‹¨í•œ í˜¸í¡ì´ë‚˜ ì§§ì€ ì‚°ì±…ë„ ë„ì›€ì´ ë  ìˆ˜ ìˆì–´ìš”.";
          } else if(currentMood === 'happy'){
            empathy = "ê¸°ë¶„ì´ ì¢‹ì•„ ë³´ì´ì…”ì„œ ì €ë„ ê¸°ì˜ë„¤ìš”!";
            solution = "íŠ¹ë³„í•œ ì¼ì´ ìˆìœ¼ì…¨ë‚˜ìš”? ì¢‹ì€ ì¼ì„ ë‚˜ëˆ„ì–´ ì£¼ì„¸ìš” ğŸ˜Š";
          }
        }
      }

      // if matched dangerous keywords (ex: suicide)
      if(matches.includes('suicide') || matches.includes('self_harm')){
        return "ë§¤ìš° ìœ„ì¤‘í•œ í‘œí˜„ì´ ê°ì§€ë©ë‹ˆë‹¤. ë‹¹ì‹ ì€ ì†Œì¤‘í•œ ì¡´ì¬ì…ë‹ˆë‹¤. ì¦‰ê°ì ì¸ ë„ì›€ì´ í•„ìš”í•˜ë©´ ì§€ì—­ ê¸´ê¸‰ë²ˆí˜¸ ë˜ëŠ” 1393(ìì‚´ì˜ˆë°©ìƒë‹´ì „í™”)ì„ ì´ìš©í•´ ì£¼ì„¸ìš”. ì§€ê¸ˆ ë°”ë¡œ ë„ì›€ì„ ë°›ì„ ìˆ˜ ìˆë‚˜ìš”?";
      }

      // if nothing matched at all -> generic empathetic small talk
      if(!empathy && !solution){
        const defaults = [
          "ê·¸ë ‡êµ°ìš”. ì¡°ê¸ˆ ë” ìì„¸íˆ ë§ì”€í•´ì£¼ì‹¤ë˜ìš”?",
          "ì œê°€ ì˜†ì—ì„œ ì˜ ë“¤ì–´ë“œë¦´ê²Œìš”. ì–´ë–¤ ì ì´ ê°€ì¥ ê³ ë¯¼ë˜ì‹œë‚˜ìš”?",
          "ê±´ê°•ê³¼ ë§ˆìŒ ì±™ê¹€ ê´€ì ì—ì„œ ë„ì™€ë“œë¦´ê²Œìš”. í˜„ì¬ ì£¼ë¡œ ëŠë¼ëŠ” ê°ì •ì„ ë§ì”€í•´ ì£¼ì„¸ìš”."
        ];
        return defaults[Math.floor(Math.random()*defaults.length)];
      }

      // combine empathy + solution (friendly tone)
      return empathy + " " + solution;
    }
  },

  // ---------- ë°ì´í„° ìƒì„±ê¸° ----------
  dataGenerator: {
    initAll: function({foods=5000, aiKeywords=2000, games=500} = {}){
      this.generateFoods(foods);
      this.generateAIKeywordsAndResponses(aiKeywords);
      this.generateGames(games);
      console.log('DATA sizes:', DATA.foods.length, Object.keys(DATA.aiKeywordsByCategory).length, DATA.games.length);
    },

    generateFoods: function(n){
      // seed healthy foods (diverse Korean + êµ­ì œì‹)
      const seed = [
        "ì§€ì¤‘í•´ì‹ ìƒëŸ¬ë“œ", "êµ¬ìš´ ì—°ì–´", "í˜„ë¯¸ ë‹­ê°€ìŠ´ì‚´ ë³¶ìŒë°¥", "ì•„ë³´ì¹´ë„ ëª…ë€ ë¹„ë¹”ë°¥",
        "ê·¸ë¦­ ìš”ê±°íŠ¸ì™€ ë¸”ë£¨ë² ë¦¬", "í† ë§ˆí†  ë‹¬ê±€ ë³¶ìŒ", "ì‹œê¸ˆì¹˜ ëœì¥êµ­", "ë‘ë¶€ ìŠ¤í…Œì´í¬",
        "ì˜¤íŠ¸ë°€ ì£½", "ì‚¶ì€ ë³‘ì•„ë¦¬ì½© ìƒëŸ¬ë“œ", "ë‹¨í˜¸ë°• ì—ê·¸ìŠ¬ëŸ¿", "í€´ë…¸ì•„ ìƒëŸ¬ë“œ",
        "í•´ì¡°ë¥˜ ë¹„ë¹”ë°¥", "ë²„ì„¯ ë“¤ê¹¨íƒ•", "ì˜¤ë¦¬í›ˆì œ ì›”ë‚¨ìŒˆ", "ì–‘ë°°ì¶” ìŒˆ",
        "ë‚«í†  ë¹„ë¹”ë°¥", "ì½”ì½”ë„› ì›Œí„°ì™€ ê²¬ê³¼ë¥˜", "ë¸Œë¡œì½œë¦¬ ìˆ˜í”„", "í†µë°€ ìƒŒë“œìœ„ì¹˜",
        "ê°€ì§€ êµ¬ì´ ë¬´ì¹¨", "ë Œí‹¸ì½© ì¹´ë ˆ", "ë¯¸ì—­êµ­(ì†Œê³ ê¸°)", "ì²­ê²½ì±„ êµ´ì†ŒìŠ¤ ë³¶ìŒ",
        "ìˆ˜ë¹„ë“œ ë‹­ê°€ìŠ´ì‚´", "ë¦¬ì½”íƒ€ ì¹˜ì¦ˆ ìƒëŸ¬ë“œ", "ì‹œì € ìƒëŸ¬ë“œ(ë¼ì´íŠ¸ë“œë ˆì‹±)", "ì¡ê³¡ë°¥ê³¼ ì±„ì†Œ",
        "ë‹¨ë°±ì§ˆ ì‰ì´í¬(ë¬´ê°€ë‹¹)", "êµ¬ìš´ ê³ êµ¬ë§ˆ", "ìƒëŸ¬ë“œ ë³¼(ì½©ë¥˜ í¬í•¨)", "ì°¸ì¹˜ ì•¼ì±„ ìƒŒë“œ"
      ];
      const variants = ["ë ˆì‹œí”¼", "í•œ ê·¸ë¦‡", "ë¼ì´íŠ¸ ë²„ì „", "ì €ì—¼ì‹", "ë‹¨ë°±ì§ˆ ê°•í™”", "ë¹„ê±´ ì˜µì…˜", "ì €ì¹¼ë¡œë¦¬", "ê¸€ë£¨í… í”„ë¦¬"];
      const foods = [];
      // include seed unique
      seed.forEach(s => foods.push(s));
      let i = 0;
      while(foods.length < n){
        const base = seed[i % seed.length];
        const v = variants[i % variants.length];
        const name = `${base} (${v} ${Math.floor(i/seed.length)+1})`;
        foods.push(name);
        i++;
      }
      DATA.foods = foods;
    },

    generateAIKeywordsAndResponses: function(minKeywords){
      // categories with essential responses (empathy + solution)
      const categories = {
        suicide: {
          keywords: ["ìì‚´","ì£½ê³ ì‹¶","ì‚´ê³ ì‹¶ì§€","ëë‚´ê³ ì‹¶","ì£½ì„ë˜"],
          empathy: "ì •ë§ í˜ë“  ìƒí™©ì´ë„¤ìš”. ë‹¹ì‹ ì˜ ì•ˆì „ì´ ê°€ì¥ ì¤‘ìš”í•©ë‹ˆë‹¤.",
          solution: "ì§€ê¸ˆ ì¦‰ê°ì ì¸ ë„ì›€ì´ í•„ìš”í•˜ì‹œë©´ 1393(ìì‚´ì˜ˆë°©ìƒë‹´ì „í™”) ë˜ëŠ” ì§€ì—­ ì‘ê¸‰ì„œë¹„ìŠ¤ë¡œ ì—°ë½í•˜ì„¸ìš”."
        },
        stress: {
          keywords: ["ìŠ¤íŠ¸ë ˆìŠ¤","ì§œì¦","í™”ë‚˜","ë²„ê±°ì›Œ","ì••ë°•ê°"],
          empathy: "ìŠ¤íŠ¸ë ˆìŠ¤ë¡œ ë§ì´ ì§€ì³ ë³´ì´ë„¤ìš”.",
          solution: "ê°„ë‹¨í•œ í˜¸í¡ë²•(4-7-8), ì§§ì€ ì‚°ì±…, ì—…ë¬´ ë¶„í• ë¡œ ë¶€ë‹´ì„ ì¤„ì—¬ë³´ì„¸ìš”."
        },
        depression: {
          keywords: ["ìš°ìš¸","ìŠ¬í¼","ë¬´ê¸°ë ¥","í¬ë§ì´ì—†","ëë‚¬ì–´"],
          empathy: "ë§ˆìŒì´ ë§ì´ ë¬´ê²êµ°ìš”.",
          solution: "ì‘ì€ ë£¨í‹´(ì‚°ì±…, ìˆ˜ë©´ ê·œì¹™, ê°„ë‹¨í•œ í™œë™)ì„ ì‹œì‘í•´ë³´ì„¸ìš”. í•„ìš”í•˜ë©´ ì „ë¬¸ê°€ ìƒë‹´ì„ ê³ ë ¤í•˜ì„¸ìš”."
        },
        insomnia: {
          keywords: ["ë¶ˆë©´","ì ì´ ì•ˆ","ê¹Šì€ ì ","ìƒˆë²½","ìˆ˜ë©´ë¶€ì¡±"],
          empathy: "ì ë“¤ê¸° ì–´ë ¤ìš°ì…¨êµ°ìš”. ì ì´ ì•ˆ ì˜¤ëŠ” ê±´ ì •ë§ ê´´ë¡­ì£ .",
          solution: "ì·¨ì¹¨ ì „ í™”ë©´ ì¤„ì´ê¸°, ì¹´í˜ì¸ ì¡°ì ˆ, ë”°ëœ»í•œ ì°¨ì™€ ë£¨í‹´ì„ ì¶”ì²œí•©ë‹ˆë‹¤."
        },
        hunger: {
          keywords: ["ë°°ê³ íŒŒ","ì•¼ì‹","ë¨¹ê³ ì‹¶ë‹¤","ì¶œì¶œ","ì €ë…ë¨¹"],
          empathy: "ì¶œì¶œí•˜êµ°ìš”.",
          solution: "ê²¬ê³¼ë¥˜ë‚˜ ìš”ê±°íŠ¸ ê°™ì€ ê°€ë²¼ìš´ ê±´ê°• ê°„ì‹ì„ ì¶”ì²œë“œë ¤ìš”."
        },
        fatigue: {
          keywords: ["í”¼ê³¤","ì§€ì³","í˜ë“¤ì–´","ì—ë„ˆì§€ì—†ì–´","ê¸°ìš´ì—†ë‹¤"],
          empathy: "ë§¤ìš° í”¼ê³¤í•´ ë³´ì…ë‹ˆë‹¤.",
          solution: "ì§§ì€ íœ´ì‹ì´ë‚˜ 15ë¶„ ë‚®ì , ìˆ˜ë¶„ì„­ì·¨ë¥¼ ê¶Œí•©ë‹ˆë‹¤."
        },
        greeting: {
          keywords: ["ì•ˆë…•","í•˜ì´","ë°˜ê°€","ì•ˆë…•í•˜ì„¸ìš”","ì˜ì§€ë‚´"],
          empathy: "ì•ˆë…•í•˜ì„¸ìš”! ë°˜ê°‘ìŠµë‹ˆë‹¤.",
          solution: "ì˜¤ëŠ˜ ê¸°ë¶„ì´ë‚˜ ëª©í‘œê°€ ìˆìœ¼ì‹ ê°€ìš”?"
        },
        general: {
          keywords: ["ê±±ì •","ë¬¸ì˜","ê³ ë¯¼","ë„ì™€ì¤˜","í˜ë“¤ì–´"],
          empathy: "ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ë¥¼ ë“£ê³  ì‹¶ì–´ìš”.",
          solution: "ì–´ë–¤ ë¶€ë¶„ì´ ê°€ì¥ ê³ ë¯¼ì´ì‹ ì§€ êµ¬ì²´ì ìœ¼ë¡œ ë§ì”€í•´ë³´ì„¸ìš”."
        }
      };

      // seed categories into DATA
      for(const cat in categories){
        DATA.aiKeywordsByCategory[cat] = categories[cat].keywords.slice();
        DATA.aiResponses[cat] = { empathy: categories[cat].empathy, solution: categories[cat].solution };
      }

      // expand keywords to reach minKeywords by morphological/variation generation
      const categoryKeys = Object.keys(DATA.aiKeywordsByCategory);
      let total = Object.values(DATA.aiKeywordsByCategory).reduce((s,a)=>s+a.length,0);
      let idx = 0;
      const suffixes = ["ìš”","ìš”..","ìš”?","ã… ","ã… ã… ","...","ì§€","ë„¤","ê°™ì•„","ê°™ìŒ","ë„¤ìš”"];
      while(total < minKeywords){
        const cat = categoryKeys[idx % categoryKeys.length];
        const baseList = DATA.aiKeywordsByCategory[cat];
        const base = baseList[idx % baseList.length] || ('í‚¤ì›Œë“œ'+idx);
        const variant = base + (Math.random() < 0.5 ? '' : suffixes[Math.floor(Math.random()*suffixes.length)]) + (Math.random() < 0.08 ? Math.floor(Math.random()*30) : '');
        // avoid duplicates
        if(!baseList.includes(variant)) baseList.push(variant);
        total++;
        idx++;
        // safety break
        if(idx>minKeywords*3) break;
      }

      // ensure important dangerous tokens present in a small special category for immediate detection
      if(!DATA.aiKeywordsByCategory.self_harm) DATA.aiKeywordsByCategory.self_harm = ["ìí•´","ìƒí•´","ì¹¼"];
    },

    generateGames: function(minGames){
      const baseQA = [
        {q:"ì„±ì¸ì˜ í•˜ë£¨ ê¶Œì¥ ë¬¼ ì„­ì·¨ëŸ‰ì€ ë³´í†µ ëª‡ ë¦¬í„°ì¼ê¹Œìš”? (ìˆ«ìë§Œ)", a:["2","2L","2ë¦¬í„°"]},
        {q:"ì ì´ ë¶€ì¡±í•  ë•Œ ë¶„ë¹„ë˜ì–´ ì‹ìš•ì„ ì´‰ì§„í•˜ëŠ” í˜¸ë¥´ëª¬ì€?", a:["ê·¸ë ë¦°"]},
        {q:"ë¹„íƒ€ë¯¼ Dë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ ê°€ì¥ ì¢‹ì€ ë°©ë²•ì€?", a:["í–‡ë¹›","ì¼ê´‘ìš•","ì‚°ì±…"]},
        {q:"3ëŒ€ ì˜ì–‘ì†ŒëŠ” íƒ„ìˆ˜í™”ë¬¼, ë‹¨ë°±ì§ˆ, ê·¸ë¦¬ê³  ë¬´ì—‡ì¼ê¹Œìš”?", a:["ì§€ë°©"]},
        {q:"ê·¼ìœ¡ íšŒë³µì— ì¤‘ìš”í•œ ì˜ì–‘ì†ŒëŠ”?", a:["ë‹¨ë°±ì§ˆ"]},
        {q:"ì„¸ê³„ë³´ê±´ê¸°êµ¬ê°€ ê¶Œì¥í•˜ëŠ” í•˜ë£¨ ë‹¹ë¥˜ ì„­ì·¨ëŸ‰ì€ ì´ ì—´ëŸ‰ì˜ ëª‡ % ì´ë‚´ì¸ê°€ìš”? (ìˆ«ìë§Œ)", a:["10","10%"]},
        {q:"ìœ ì‚°ì†Œ ìš´ë™ì˜ ëŒ€í‘œì ì¸ ì˜ˆë¡œ ì¤„ì„ ì´ìš©í•´ ë›°ëŠ” ìš´ë™ì€?", a:["ì¤„ë„˜ê¸°"]},
        {q:"ì§œê²Œ ë¨¹ìœ¼ë©´ ê±¸ë¦¬ê¸° ì‰¬ìš´ ëŒ€í‘œ ì§ˆë³‘ì€?", a:["ê³ í˜ˆì••"]},
        {q:"ëˆˆ ê±´ê°•ì— ì¢‹ì€ ë¹„íƒ€ë¯¼ Aê°€ í’ë¶€í•œ ì£¼í™©ìƒ‰ ì±„ì†ŒëŠ”?", a:["ë‹¹ê·¼"]},
        {q:"ì‚¬ëŒì˜ ë¼ˆ ê°œìˆ˜ëŠ” ì•½ ëª‡ ê°œì¸ê°€ìš”? (ìˆ«ìë§Œ)", a:["206","206ê°œ"]}
      ];
      const games = [];
      // push base
      baseQA.forEach(x => games.push(x));
      let i = 0;
      // generate variations by rewording or numeric variants until minGames
      const templates = [
        (b, n)=> ({q: b.q.replace("ì„±ì¸ì˜","ì„±ì¸ í‰ê· ì˜")+" (ë³€í˜• "+n+")", a: b.a}),
        (b, n)=> ({q: b.q.replace("ì ì´ ë¶€ì¡±í•  ë•Œ","ìˆ˜ë©´ ë¶€ì¡± ì‹œ")+" (ë³€í˜• "+n+")", a: b.a}),
        (b, n)=> ({q: b.q+" (ê°„ë‹¨íˆ)", a: b.a})
      ];
      while(games.length < minGames){
        const base = baseQA[i % baseQA.length];
        const t = templates[i % templates.length];
        games.push(t(base, i));
        i++;
        if(i>minGames*2) break;
      }
      DATA.games = games;
    }
  },

  // ---------- ìœ í‹¸ ----------
  setupNavActiveBehavior: function(){
    document.querySelectorAll('.nav-btn').forEach(btn=>{
      btn.addEventListener('click', ()=> {
        document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
      });
    });
  },

  setDailyQuote: function(){
    const qs = [
      "ì‘ì€ ë³€í™”ê°€ í° ê²°ì‹¬ì„ ë§Œë“­ë‹ˆë‹¤.",
      "ì˜¤ëŠ˜ì˜ ì„ íƒì´ ë‚´ì¼ì˜ ê±´ê°•ì„ ë§Œë“­ë‹ˆë‹¤.",
      "ì‰¼ë„ í•˜ë‚˜ì˜ ìƒì‚°ì„±ì…ë‹ˆë‹¤.",
      "í•œ ê±¸ìŒì˜ ì›€ì§ì„ì´ í° ì°¨ì´ë¥¼ ë§Œë“­ë‹ˆë‹¤."
    ];
    document.getElementById('dailyQuote').textContent = qs[Math.floor(Math.random()*qs.length)];
  }
};

// ì•± ì‹œì‘
app.init();
</script>
</body>
</html>
