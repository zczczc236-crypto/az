<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê±´ê°•Â·ë©˜íƒˆ ê´€ë¦¬ í’€ë²„ì „</title>
<style>
body{margin:0;font-family:system-ui;background:linear-gradient(135deg,#89f7fe,#66a6ff,#fbc2eb,#a18cd1);color:#333;transition:0.5s;}
.container{max-width:420px;margin:0 auto;padding:15px;}
.screen{display:none;}
.active{display:block;}
button{width:100%;padding:14px;margin:8px 0;border:none;border-radius:12px;background:#5a7cff;color:white;font-size:16px;cursor:pointer;transition:.2s;}
button:hover{opacity:.9;}
h2{margin:0 0 12px;}
.character{font-size:70px;text-align:center;transition:.3s;}
.chat-box{height:250px;overflow-y:auto;background:#f3f5fb;border-radius:14px;padding:12px;margin-bottom:10px;}
.chat-user{text-align:right;margin:6px 0;}
.chat-ai{text-align:left;margin:6px 0;color:#333;}
input,select{width:100%;padding:10px;margin-top:5px;border-radius:12px;border:1px solid #ddd;box-sizing:border-box;}
.small{font-size:13px;color:#666;}
.backBtn{background:#888;margin-top:10px;}
</style>
</head>
<body>
<div class="container">

<!-- ë¡œê·¸ì¸ -->
<div id="loginScreen" class="screen active">
<h2>ğŸ”‘ ë¡œê·¸ì¸ / íšŒì›ê°€ì…</h2>
<input type="text" id="username" placeholder="ì´ë¦„">
<input type="number" id="age" placeholder="ë‚˜ì´">
<input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
<button onclick="registerUser()">íšŒì›ê°€ì…</button>
<button onclick="loginUser()">ë¡œê·¸ì¸</button>
<p class="small" id="loginMsg"></p>
</div>

<!-- í™ˆ -->
<div id="home" class="screen">
<h2>ğŸ  ê±´ê°•ê´€ë¦¬ í™ˆ</h2>
<button onclick="showScreen('mental')">ğŸ§  ë©˜íƒˆ ê´€ë¦¬</button>
<button onclick="showScreen('sleep')">ğŸŒ™ ìˆ˜ë©´ ê¸°ë¡</button>
<button onclick="showScreen('food')">ğŸ¥— ìŒì‹ ì¶”ì²œ</button>
<button onclick="showScreen('game')">ğŸ® ë¯¸ë‹ˆê²Œì„</button>
<button onclick="showScreen('chat')">ğŸ—¨ï¸ AI ìƒë‹´</button>
<p class="small" id="welcomeMsg"></p>
<button class="backBtn" onclick="logoutUser()">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
</div>

<!-- ë©˜íƒˆ -->
<div id="mental" class="screen">
<h2>ğŸ§ ë‚´ ìºë¦­í„°</h2>
<div class="character" id="char">ğŸ˜</div>
<p class="small" id="charState"></p>
<h2>ì˜¤ëŠ˜ ë©˜íƒˆ ì„ íƒ</h2>
<button onclick="setMood('ğŸ˜„')">ì¢‹ìŒ</button>
<button onclick="setMood('ğŸ˜')">ë³´í†µ</button>
<button onclick="setMood('ğŸ˜¢')">ë‚˜ì¨</button>
<button onclick="setMood('ğŸ¥±')">ì¡¸ë¦¼</button>
<button onclick="setMood('ğŸ˜')">ì‹ ë‚¨</button>
<button class="backBtn" onclick="showScreen('home')">â¬…ï¸ í™ˆìœ¼ë¡œ</button>
</div>

<!-- ìˆ˜ë©´ -->
<div id="sleep" class="screen">
<h2>ğŸŒ™ ìˆ˜ë©´ ê¸°ë¡</h2>
<label>ìëŠ” ì‹œê°„</label>
<input type="number" id="sleepStartHour" placeholder="ì‹œê°„ (0~12)">
<select id="sleepStartAMPM"><option>ì˜¤ì „</option><option>ì˜¤í›„</option></select>
<label>ì¼ì–´ë‚˜ëŠ” ì‹œê°„</label>
<input type="number" id="sleepEndHour" placeholder="ì‹œê°„ (0~12)">
<select id="sleepEndAMPM"><option>ì˜¤ì „</option><option>ì˜¤í›„</option></select>
<button onclick="saveSleep()">ì €ì¥</button>
<p class="small" id="sleepMsg"></p>
<button class="backBtn" onclick="showScreen('home')">â¬…ï¸ í™ˆìœ¼ë¡œ</button>
</div>

<!-- ìŒì‹ -->
<div id="food" class="screen">
<h2>ğŸ¥— ì˜¤ëŠ˜ì˜ ì¶”ì²œ ìŒì‹</h2>
<select id="foodCategory">
<option value="all">ì „ì²´</option>
<option value="protein">ë‹¨ë°±ì§ˆ</option>
<option value="fruit">ê³¼ì¼</option>
<option value="veg">ì±„ì†Œ</option>
<option value="snack">ê°„ì‹</option>
<option value="supplement">ê±´ê°•ì‹í’ˆ</option>
<option value="nuts">ê²¬ê³¼ë¥˜</option>
</select>
<p id="foodText"></p>
<button onclick="recommendFood()">ë‹¤ì‹œ ì¶”ì²œ</button>
<button class="backBtn" onclick="showScreen('home')">â¬…ï¸ í™ˆìœ¼ë¡œ</button>
</div>

<!-- ë¯¸ë‹ˆê²Œì„ -->
<div id="game" class="screen">
<h2>ğŸ® ë¯¸ë‹ˆê²Œì„</h2>
<p id="gameQ"></p>
<input type="text" id="gameAns" placeholder="ì •ë‹µ ì…ë ¥">
<button onclick="checkGame()">ì œì¶œ</button>
<p class="small" id="gameMsg"></p>
<button onclick="nextGame()">ë‹¤ìŒ ë¬¸ì œ</button>
<button class="backBtn" onclick="showScreen('home')">â¬…ï¸ í™ˆìœ¼ë¡œ</button>
</div>

<!-- AI ìƒë‹´ -->
<div id="chat" class="screen">
<h2>ğŸ—¨ï¸ AI ìƒë‹´</h2>
<div class="chat-box" id="chatBox"></div>
<input type="text" id="userChat" placeholder="ë§ì„ ì…ë ¥í•˜ê³  ì—”í„°" onkeydown="if(event.key==='Enter') sendChat()">
<button class="backBtn" onclick="showScreen('home')">â¬…ï¸ í™ˆìœ¼ë¡œ</button>
</div>

</div>

<script src="foods.json"></script>
<script src="aiKeywords.json"></script>
<script src="games.json"></script>

<script>
// ---------------- SPA í™”ë©´ ----------------
function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// ---------------- íšŒì›ê°€ì…/ë¡œê·¸ì¸ ----------------
let users=JSON.parse(localStorage.getItem("users")||"{}");
let currentUser=null;
let userData={mood:"ğŸ˜",sleep:"",chat:[],foodHistory:[]};

function registerUser(){
  const name=document.getElementById("username").value.trim();
  const age=parseInt(document.getElementById("age").value);
  const pw=document.getElementById("password").value;
  if(!name||isNaN(age)||!pw){document.getElementById("loginMsg").textContent="ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥!";return;}
  if(users[name]){document.getElementById("loginMsg").textContent="ì´ë¯¸ ì¡´ì¬";}
  else{
    users[name]={age:age,password:pw,mood:"ğŸ˜",chat:[],sleep:"",foodHistory:[]};
    localStorage.setItem("users",JSON.stringify(users));
    document.getElementById("loginMsg").textContent="ê°€ì… ì™„ë£Œ!";
  }
}

function loginUser(){
  const name=document.getElementById("username").value.trim();
  const pw=document.getElementById("password").value;
  if(users[name]&&users[name].password===pw){
    currentUser=name;
    userData=users[currentUser];
    char.textContent=userData.mood||"ğŸ˜";
    charState.textContent="";
    document.getElementById("welcomeMsg").textContent=`í™˜ì˜í•©ë‹ˆë‹¤, ${currentUser}ë‹˜ (ë‚˜ì´:${users[currentUser].age})`;
    showScreen('home');
  }else{
    document.getElementById("loginMsg").textContent="ë¡œê·¸ì¸ ì‹¤íŒ¨!";
  }
}

function logoutUser(){
  currentUser=null;
  userData={mood:"ğŸ˜",sleep:"",chat:[],foodHistory:[]};
  showScreen('loginScreen');
}

// ---------------- ë©˜íƒˆ ----------------
const char=document.getElementById("char");
const charState=document.getElementById("charState");
function setMood(m){
  char.textContent=m;
  const msgs={"ğŸ˜„":["ì¢‹ì•„ìš”! ì˜¤ëŠ˜ í™œê¸°ì°¨ë„¤ìš”!"],"ğŸ˜":["ê´œì°®ì•„ìš”. ì²œì²œíˆ íë§í•´ìš”."],"ğŸ˜¢":["í˜ë“¤ ìˆ˜ ìˆì–´ìš”. ì ê¹ ì‰¬ì„¸ìš”."],"ğŸ¥±":["ì¡¸ë¦¬êµ°ìš”. ì»¤í”¼ë‚˜ ìŠ¤íŠ¸ë ˆì¹­!"],"ğŸ˜":["ë©‹ì ¸ìš”! í™œê¸°ì°¬ í•˜ë£¨!"]};
  charState.textContent=msgs[m][Math.floor(Math.random()*msgs[m].length)];
  if(currentUser){
    userData.mood=m;
    users[currentUser]=userData;
    localStorage.setItem("users",JSON.stringify(users));
  }
}

// ---------------- ìˆ˜ë©´ ----------------
function saveSleep(){
  const startH=parseInt(document.getElementById("sleepStartHour").value);
  const startM=document.getElementById("sleepStartAMPM").value;
  const endH=parseInt(document.getElementById("sleepEndHour").value);
  const endM=document.getElementById("sleepEndAMPM").value;
  if(isNaN(startH)||isNaN(endH)){document.getElementById("sleepMsg").textContent="ì‹œê°„ ì…ë ¥ í•„ìš”";return;}
  const start=(startM==="ì˜¤í›„"?startH+12:startH);
  const end=(endM==="ì˜¤í›„"?endH+12:endH);
  const hours=end-start<0?24+(end-start):end-start;
  userData.sleep=hours+"ì‹œê°„";
  document.getElementById("sleepMsg").textContent="ìˆ˜ë©´ ê¸°ë¡ë¨: "+userData.sleep;
  if(currentUser){
    users[currentUser]=userData;
    localStorage.setItem("users",JSON.stringify(users));
  }
}

// ---------------- ìŒì‹ ----------------
function recommendFood(){
  const cat=document.getElementById("foodCategory").value;
  let list=foods;
  if(cat!=="all"){list=list.filter(f=>f.cat===cat);}
  if(list.length===0){document.getElementById("foodText").textContent="ì¶”ì²œ ì—†ìŒ";return;}
  const pick=list[Math.floor(Math.random()*list.length)];
  document.getElementById("foodText").textContent=pick.name;
  if(currentUser){
    userData.foodHistory.push(pick.name);
    users[currentUser]=userData;
    localStorage.setItem("users",JSON.stringify(users));
  }
}

// ---------------- ë¯¸ë‹ˆê²Œì„ ----------------
let currentGame=0;
function loadGame(){nextGame();}
function nextGame(){
  currentGame=Math.floor(Math.random()*games.length);
  const g=games[currentGame];
  document.getElementById("gameQ").textContent=g.q;
  document.getElementById("gameAns").value="";
  document.getElementById("gameMsg").textContent="";
}
function checkGame(){
  const ans=document.getElementById("gameAns").value.trim().toLowerCase();
  const correct=games[currentGame].a.toLowerCase();
  if(ans===correct){document.getElementById("gameMsg").textContent="âœ… ì •ë‹µ!";}
  else{document.getElementById("gameMsg").textContent="âŒ ì˜¤ë‹µ! ì •ë‹µ: "+games[currentGame].a;}
}

// ---------------- AI ìƒë‹´ ----------------
function sendChat(){
  const msg=document.getElementById("userChat").value.trim();
  if(!msg)return;
  const box=document.getElementById("chatBox");
  box.innerHTML+=`<div class="chat-user">${msg}</div>`;
  document.getElementById("userChat").value="";
  let response="ì£„ì†¡, ì´í•´í•˜ì§€ ëª»í–ˆì–´ìš”.";
  for(const k of aiKeywords){
    if(k.k.some(w=>msg.includes(w))){response=k.r[Math.floor(Math.random()*k.r.length)];break;}
  }
  box.innerHTML+=`<div class="chat-ai">${response}</div>`;
  box.scrollTop=box.scrollHeight;
  if(currentUser){
    userData.chat.push({user:msg,ai:response});
    users[currentUser]=userData;
    localStorage.setItem("users",JSON.stringify(users));
  }
}

// ---------------- ì´ˆê¸°í™” ----------------
window.onload=()=>{
  loadGame();
};
</script>
</body>
</html>

<!-- deploy test -->
