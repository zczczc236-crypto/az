<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#6366f1">
<meta name="description" content="AI ê¸°ë°˜ ê±´ê°• & ë©˜íƒˆ ì¼€ì–´ íŒŒíŠ¸ë„ˆ">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>ë§ˆìŒ ì±™ê¹€ & ê±´ê°• íŒŒíŠ¸ë„ˆ Pro</title>
<link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoi66eI7J2M7LGE6rmA7ZSEIO2MjO2KuOuEiCIsInNob3J0X25hbWUiOiLqsbTqsJXsvIAiLCJzdGFydF91cmwiOiIuIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiI2ZmZmZmZiIsInRoZW1lX2NvbG9yIjoiIzYzNjZmMSIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXlOVFlpSUdobGFXZG9kRDBpTWpVMklqNDhjbVZqZENCM2FXUjBhRDBpTWpVMklpQm9aV2xuYUhROUlqSTFOaUlnWm1sc2JEMGlJell6TmpabU1TSXZQand2YzNablBnPT0iLCJzaXplcyI6IjI1NngyNTYiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0=">
<style>
:root {
  --primary: #6366f1;
  --primary-dark: #4f46e5;
  --accent: #10b981;
  --accent-dark: #059669;
  --danger: #ef4444;
  --danger-dark: #dc2626;
  --warning: #f59e0b;
  --bg: #f9fafb;
  --bg-dark: #111827;
  --card: #ffffff;
  --card-dark: #1f2937;
  --text: #1f2937;
  --text-dark: #f9fafb;
  --text-muted: #6b7280;
  --text-muted-dark: #9ca3af;
  --border: #e5e7eb;
  --border-dark: #374151;
  --shadow: rgba(0, 0, 0, 0.1);
  --shadow-dark: rgba(0, 0, 0, 0.3);
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

[data-theme="dark"] {
  --bg: var(--bg-dark);
  --card: var(--card-dark);
  --text: var(--text-dark);
  --text-muted: var(--text-muted-dark);
  --border: var(--border-dark);
  --shadow: var(--shadow-dark);
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans KR", "Malgun Gothic", Roboto, "Helvetica Neue", Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  overflow-x: hidden;
  transition: var(--transition);
}

.app-container {
  max-width: 480px;
  margin: 0 auto;
  min-height: 100vh;
  background: var(--card);
  box-shadow: 0 0 40px var(--shadow);
  display: flex;
  flex-direction: column;
  position: relative;
}

/* Header */
header {
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color: white;
  padding: 20px;
  text-align: center;
  box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
  position: sticky;
  top: 0;
  z-index: 100;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

header h1 {
  font-size: 1.25rem;
  font-weight: 700;
  flex: 1;
}

.theme-toggle {
  background: rgba(255, 255, 255, 0.2);
  border: none;
  color: white;
  font-size: 1.5rem;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
}

.theme-toggle:hover {
  background: rgba(255, 255, 255, 0.3);
  transform: scale(1.1);
}

/* Screens */
.screen {
  display: none;
  padding: 20px;
  padding-bottom: 100px;
  flex: 1;
  overflow-y: auto;
  animation: fadeIn 0.3s ease-in;
}

.screen.active {
  display: block;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Cards */
.card {
  background: var(--card);
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 16px;
  box-shadow: 0 2px 8px var(--shadow);
  border: 1px solid var(--border);
  transition: var(--transition);
}

.card:hover {
  box-shadow: 0 4px 16px var(--shadow);
  transform: translateY(-2px);
}

.card h2 {
  font-size: 1.25rem;
  margin-bottom: 12px;
  color: var(--text);
}

.card h3 {
  font-size: 1.1rem;
  margin-bottom: 10px;
  color: var(--text);
}

/* Buttons */
.btn {
  width: 100%;
  padding: 14px 20px;
  border: none;
  border-radius: 12px;
  font-weight: 600;
  font-size: 1rem;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color: white;
}

.btn-primary:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
}

.btn-secondary {
  background: var(--bg);
  color: var(--primary);
  border: 2px solid var(--primary);
}

.btn-secondary:hover:not(:disabled) {
  background: var(--primary);
  color: white;
}

.btn-danger {
  background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
  color: white;
}

.btn-danger:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
}

.btn-accent {
  background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
  color: white;
}

.btn-accent:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-group {
  display: flex;
  gap: 10px;
}

.btn-group .btn {
  flex: 1;
}

/* Inputs */
input, select, textarea {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid var(--border);
  border-radius: 10px;
  font-size: 1rem;
  background: var(--card);
  color: var(--text);
  transition: var(--transition);
  font-family: inherit;
}

input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

.input-group {
  margin-bottom: 12px;
}

.input-group label {
  display: block;
  margin-bottom: 6px;
  font-weight: 600;
  color: var(--text);
}

/* Mood Grid */
.mood-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  margin-top: 16px;
}

.mood-btn {
  background: var(--bg);
  border: 3px solid var(--border);
  border-radius: 16px;
  padding: 20px;
  font-size: 2.5rem;
  cursor: pointer;
  transition: var(--transition);
  aspect-ratio: 1;
  display: flex;
  align-items: center;
  justify-content: center;
}

.mood-btn:hover {
  transform: scale(1.1);
  border-color: var(--primary);
  box-shadow: 0 4px 12px var(--shadow);
}

.mood-btn:active {
  transform: scale(0.95);
}

/* Chat */
.chat-container {
  height: calc(100vh - 280px);
  display: flex;
  flex-direction: column;
}

.chat-history {
  flex: 1;
  overflow-y: auto;
  background: var(--bg);
  border-radius: 12px;
  padding: 16px;
  border: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  gap: 12px;
  scroll-behavior: smooth;
}

.chat-message {
  max-width: 80%;
  padding: 12px 16px;
  border-radius: 16px;
  font-size: 0.95rem;
  line-height: 1.5;
  word-wrap: break-word;
  animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.chat-message.user {
  align-self: flex-end;
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color: white;
  border-bottom-right-radius: 4px;
}

.chat-message.ai {
  align-self: flex-start;
  background: var(--card);
  border: 1px solid var(--border);
  color: var(--text);
  border-bottom-left-radius: 4px;
}

.chat-message.system {
  align-self: center;
  background: var(--warning);
  color: white;
  font-size: 0.85rem;
  max-width: 90%;
  text-align: center;
}

.chat-input-container {
  display: flex;
  gap: 10px;
  margin-top: 12px;
}

.chat-input-container input {
  flex: 1;
}

.chat-input-container .btn {
  width: auto;
  padding: 12px 20px;
}

.typing-indicator {
  display: none;
  align-items: center;
  gap: 4px;
  padding: 12px 16px;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 16px;
  width: fit-content;
}

.typing-indicator.active {
  display: flex;
}

.typing-dot {
  width: 8px;
  height: 8px;
  background: var(--text-muted);
  border-radius: 50%;
  animation: typing 1.4s infinite;
}

.typing-dot:nth-child(2) { animation-delay: 0.2s; }
.typing-dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes typing {
  0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
  30% { transform: translateY(-8px); opacity: 1; }
}

/* Bottom Nav */
.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--card);
  border-top: 1px solid var(--border);
  display: none;
  justify-content: space-around;
  padding: 8px 0;
  max-width: 480px;
  margin: 0 auto;
  z-index: 99;
  box-shadow: 0 -4px 12px var(--shadow);
}

.bottom-nav.active {
  display: flex;
}

.nav-btn {
  border: none;
  background: none;
  display: flex;
  flex-direction: column;
  align-items: center;
  font-size: 0.7rem;
  color: var(--text-muted);
  cursor: pointer;
  padding: 8px 12px;
  border-radius: 12px;
  transition: var(--transition);
  flex: 1;
  max-width: 80px;
}

.nav-btn span {
  font-size: 1.5rem;
  margin-bottom: 4px;
}

.nav-btn.active {
  color: var(--primary);
  background: rgba(99, 102, 241, 0.1);
}

.nav-btn:hover {
  background: rgba(99, 102, 241, 0.05);
}

/* Stats */
.stat-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  margin-top: 12px;
}

.stat-card {
  background: var(--bg);
  padding: 16px;
  border-radius: 12px;
  text-align: center;
  border: 1px solid var(--border);
}

.stat-value {
  font-size: 1.8rem;
  font-weight: 700;
  color: var(--primary);
  margin-bottom: 4px;
}

.stat-label {
  font-size: 0.85rem;
  color: var(--text-muted);
}

/* Chart */
.chart-container {
  margin-top: 16px;
  background: var(--bg);
  padding: 16px;
  border-radius: 12px;
  border: 1px solid var(--border);
}

canvas {
  max-width: 100%;
  height: auto;
}

/* Utility */
.hidden { display: none !important; }
.text-center { text-align: center; }
.text-muted { color: var(--text-muted); font-size: 0.9rem; }
.text-small { font-size: 0.85rem; }
.mb-1 { margin-bottom: 8px; }
.mb-2 { margin-bottom: 16px; }
.mt-1 { margin-top: 8px; }
.mt-2 { margin-top: 16px; }
.divider { border: none; border-top: 1px solid var(--border); margin: 16px 0; }

/* Loading */
.loading-spinner {
  width: 40px;
  height: 40px;
  border: 4px solid var(--border);
  border-top-color: var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 20px auto;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Notifications */
.notification {
  position: fixed;
  top: 80px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--card);
  color: var(--text);
  padding: 16px 24px;
  border-radius: 12px;
  box-shadow: 0 4px 16px var(--shadow);
  border: 1px solid var(--border);
  z-index: 1000;
  max-width: 90%;
  animation: slideDown 0.3s ease-out;
  display: none;
}

.notification.active {
  display: block;
}

.notification.success {
  border-left: 4px solid var(--accent);
}

.notification.error {
  border-left: 4px solid var(--danger);
}

.notification.warning {
  border-left: 4px solid var(--warning);
}

@keyframes slideDown {
  from { opacity: 0; transform: translate(-50%, -20px); }
  to { opacity: 1; transform: translate(-50%, 0); }
}

/* Progress Bar */
.progress-bar {
  width: 100%;
  height: 8px;
  background: var(--border);
  border-radius: 4px;
  overflow: hidden;
  margin: 8px 0;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--primary), var(--accent));
  border-radius: 4px;
  transition: width 0.3s ease;
}

/* Badge */
.badge {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 600;
  background: var(--primary);
  color: white;
}

.badge.accent { background: var(--accent); }
.badge.danger { background: var(--danger); }
.badge.warning { background: var(--warning); }

/* Scrollbar */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--bg);
}

::-webkit-scrollbar-thumb {
  background: var(--border);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--text-muted);
}

/* Responsive */
@media (max-width: 480px) {
  .app-container {
    box-shadow: none;
  }
  
  .card {
    border-radius: 12px;
  }
  
  .mood-grid {
    gap: 8px;
  }
  
  .mood-btn {
    padding: 16px;
    font-size: 2rem;
  }
}

/* Accessibility */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

/* Focus visible */
*:focus-visible {
  outline: 2px solid var(--primary);
  outline-offset: 2px;
}

/* Animations */
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.pulse {
  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

/* Export/Import */
.file-input-wrapper {
  position: relative;
  overflow: hidden;
  display: inline-block;
  width: 100%;
}

.file-input-wrapper input[type=file] {
  position: absolute;
  left: -9999px;
}

.file-input-label {
  display: block;
  padding: 14px 20px;
  background: var(--bg);
  color: var(--primary);
  border: 2px solid var(--primary);
  border-radius: 12px;
  text-align: center;
  cursor: pointer;
  transition: var(--transition);
  font-weight: 600;
}

.file-input-label:hover {
  background: var(--primary);
  color: white;
}

/* Time Input */
.time-input-group {
  display: flex;
  gap: 10px;
  align-items: center;
}

.time-input-group label {
  min-width: 60px;
  font-weight: 600;
}

.time-input-group input {
  flex: 1;
}

.time-input-group select {
  width: auto;
  min-width: 80px;
}

/* List */
.list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.list-item {
  padding: 12px;
  border-bottom: 1px solid var(--border);
  transition: var(--transition);
}

.list-item:last-child {
  border-bottom: none;
}

.list-item:hover {
  background: var(--bg);
}

/* Food recommendation animation */
.food-result {
  background: var(--bg);
  padding: 20px;
  border-radius: 12px;
  text-align: center;
  font-size: 1.3rem;
  font-weight: 700;
  color: var(--primary);
  min-height: 80px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition);
}

.food-result.animating {
  animation: foodPulse 0.5s ease-in-out;
}

@keyframes foodPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}
</style>
</head>
<body>
<div class="app-container">
  <header>
    <h1 id="headerTitle">ë§ˆìŒ ì±™ê¹€ & ê±´ê°• íŒŒíŠ¸ë„ˆ Pro</h1>
    <button class="theme-toggle" onclick="app.toggleTheme()" aria-label="í…Œë§ˆ ì „í™˜">
      <span id="themeIcon">ğŸŒ™</span>
    </button>
  </header>

  <!-- LOGIN SCREEN -->
  <div id="screen-login" class="screen active">
    <div class="card text-center" style="margin-top: 60px;">
      <div style="font-size: 4rem; margin-bottom: 16px;">ğŸ§˜</div>
      <h2>í™˜ì˜í•©ë‹ˆë‹¤</h2>
      <p class="text-muted mb-2">AIì™€ í•¨ê»˜í•˜ëŠ” ê±´ê°•í•œ ëª¸ê³¼ ë§ˆìŒ</p>

      <div id="loginBox">
        <div class="input-group">
          <input id="loginId" type="text" placeholder="ì•„ì´ë””" autocomplete="username">
        </div>
        <div class="input-group">
          <input id="loginPw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" autocomplete="current-password">
        </div>
        <button class="btn btn-primary mb-1" onclick="app.auth.login()">ë¡œê·¸ì¸</button>
        <button class="btn btn-secondary" onclick="app.ui.toggleSignup(true)">íšŒì›ê°€ì…</button>
      </div>

      <div id="signupBox" class="hidden">
        <div class="input-group">
          <input id="regId" type="text" placeholder="ì•„ì´ë”” (í•„ìˆ˜)" autocomplete="username">
        </div>
        <div class="input-group">
          <input id="regPw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ (í•„ìˆ˜)" autocomplete="new-password">
        </div>
        <div class="input-group">
          <input id="regAge" type="number" placeholder="ë‚˜ì´ (ì„ íƒ)" min="1" max="150">
        </div>
        <button class="btn btn-primary mb-1" onclick="app.auth.signup()">ê°€ì…í•˜ê¸°</button>
        <button class="btn btn-secondary" onclick="app.ui.toggleSignup(false)">ë¡œê·¸ì¸ìœ¼ë¡œ</button>
      </div>
      <p id="authMsg" class="text-muted mt-1" style="color: var(--danger);"></p>
    </div>
  </div>

  <!-- HOME SCREEN -->
  <div id="screen-home" class="screen">
    <div class="card">
      <h2>ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”, <span id="userNameDisplay">ê²ŒìŠ¤íŠ¸</span>ë‹˜!</h2>
      <p id="greetingMsg" class="text-muted">ì˜¤ëŠ˜ë„ ê±´ê°•í•œ í•˜ë£¨ ë˜ì„¸ìš”.</p>
      
      <div class="stat-grid mt-2">
        <div class="stat-card">
          <div class="stat-value" id="homeDayCount">0</div>
          <div class="stat-label">í•¨ê»˜í•œ ë‚ </div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="homeMoodCount">0</div>
          <div class="stat-label">ê¸°ë¶„ ê¸°ë¡</div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>ğŸ’­ ì˜¤ëŠ˜ì˜ í•œë§ˆë””</h2>
      <p id="dailyQuote" class="text-muted" style="font-style: italic; font-size: 1rem;"></p>
    </div>

    <div class="card" style="cursor: pointer;" onclick="app.nav.go('mental')">
      <h2>ğŸ’— í˜„ì¬ ê¸°ë¶„</h2>
      <div id="homeMoodDisplay" class="stat-value" style="font-size: 1.5rem;">ê¸°ë¡ ì—†ìŒ</div>
      <p class="text-muted text-small">íƒ­í•˜ì—¬ ê¸°ë¡í•˜ê¸°</p>
    </div>

    <div class="card">
      <h2>ğŸ½ ì˜¤ëŠ˜ì˜ ì¶”ì²œ ì‹ë‹¨</h2>
      <div id="homeFoodResult" class="food-result">ì¶”ì²œë°›ì•„ë³´ì„¸ìš”</div>
      <div class="btn-group mt-1">
        <button class="btn btn-accent" onclick="app.food.recommend('#homeFoodResult')">ì¶”ì²œë°›ê¸°</button>
        <button class="btn btn-secondary" onclick="app.food.recommend('#homeFoodResult')">ë‹¤ì‹œ</button>
      </div>
    </div>

    <div class="card">
      <h2>âš™ï¸ ì„¤ì •</h2>
      <div class="btn-group">
        <button class="btn btn-secondary" onclick="app.data.exportData()">ğŸ“¤ ë‚´ë³´ë‚´ê¸°</button>
        <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">ğŸ“¥ ê°€ì ¸ì˜¤ê¸°</button>
      </div>
      <div class="file-input-wrapper hidden">
        <input type="file" id="importFile" accept=".json" onchange="app.data.importData(event)">
      </div>
      <button class="btn btn-danger mt-1" onclick="app.auth.logout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </div>

  <!-- MENTAL SCREEN -->
  <div id="screen-mental" class="screen">
    <div class="card">
      <h2>ì§€ê¸ˆ ê¸°ë¶„ì´ ì–´ë– ì‹ ê°€ìš”?</h2>
      <p class="text-muted">ê°ì •ì„ ì†”ì§í•˜ê²Œ í‘œí˜„í•´ë³´ì„¸ìš”.</p>
      <div class="mood-grid">
        <button class="mood-btn" onclick="app.mental.setMood('happy')" aria-label="í–‰ë³µ">ğŸ˜„</button>
        <button class="mood-btn" onclick="app.mental.setMood('calm')" aria-label="í‰ì˜¨">ğŸ˜Œ</button>
        <button class="mood-btn" onclick="app.mental.setMood('excited')" aria-label="ì‹ ë‚¨">ğŸ¤©</button>
        <button class="mood-btn" onclick="app.mental.setMood('neutral')" aria-label="ë³´í†µ">ğŸ˜</button>
        <button class="mood-btn" onclick="app.mental.setMood('worried')" aria-label="ê±±ì •">ğŸ˜Ÿ</button>
        <button class="mood-btn" onclick="app.mental.setMood('sad')" aria-label="ìŠ¬í””">ğŸ˜¢</button>
        <button class="mood-btn" onclick="app.mental.setMood('angry')" aria-label="í™”ë‚¨">ğŸ˜¡</button>
        <button class="mood-btn" onclick="app.mental.setMood('tired')" aria-label="í”¼ê³¤">ğŸ˜«</button>
        <button class="mood-btn" onclick="app.mental.setMood('anxious')" aria-label="ë¶ˆì•ˆ">ğŸ˜°</button>
      </div>
    </div>
    
    <div id="moodResultCard" class="card hidden">
      <h2>ğŸ’¡ AIì˜ ê³µê° & ì œì•ˆ</h2>
      <p id="moodComment" style="font-size: 1.05rem; line-height: 1.7;"></p>
      <div class="divider"></div>
      <p class="text-muted text-small">ğŸ’¾ ê¸°ë¡ì€ ì•ˆì „í•˜ê²Œ ë¡œì»¬ì— ì €ì¥ë©ë‹ˆë‹¤.</p>
    </div>

    <div class="card">
      <h2>ğŸ“Š ê¸°ë¶„ í†µê³„ (ìµœê·¼ 7ì¼)</h2>
      <canvas id="moodChart" width="400" height="250"></canvas>
    </div>

    <div class="card">
      <h2>ğŸ“… ìµœê·¼ ê¸°ë¶„ ê¸°ë¡</h2>
      <ul id="moodHistoryList" class="list">
        <li class="text-muted text-center">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</li>
      </ul>
    </div>
  </div>

  <!-- SLEEP SCREEN -->
  <div id="screen-sleep" class="screen">
    <div class="card">
      <h2>ğŸŒ™ ìˆ˜ë©´ ê¸°ë¡</h2>
      <div class="time-input-group mt-1">
        <label>ì·¨ì¹¨</label>
        <input id="sleepTime" type="time" value="23:00">
        <select id="sleepAmpm">
          <option value="PM">ì˜¤í›„</option>
          <option value="AM">ì˜¤ì „</option>
        </select>
      </div>
      <div class="time-input-group mt-1">
        <label>ê¸°ìƒ</label>
        <input id="wakeTime" type="time" value="07:00">
        <select id="wakeAmpm">
          <option value="AM" selected>ì˜¤ì „</option>
          <option value="PM">ì˜¤í›„</option>
        </select>
      </div>
      <div class="input-group mt-1">
        <label>ìˆ˜ë©´ ì§ˆ (1-10)</label>
        <input id="sleepQuality" type="range" min="1" max="10" value="7" 
               oninput="document.getElementById('qualityValue').textContent = this.value">
        <div class="text-center mt-1">
          <span class="badge">í’ˆì§ˆ: <span id="qualityValue">7</span>/10</span>
        </div>
      </div>
      <button class="btn btn-primary mt-2" onclick="app.sleep.save()">ğŸ’¾ ê¸°ë¡ ì €ì¥</button>
    </div>

    <div class="card">
      <h2>ğŸ“ˆ ìˆ˜ë©´ í†µê³„ (ìµœê·¼ 7ì¼)</h2>
      <div class="stat-grid mb-2">
        <div class="stat-card">
          <div class="stat-value" id="avgSleepHours">0h</div>
          <div class="stat-label">í‰ê·  ìˆ˜ë©´</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="avgSleepQuality">0</div>
          <div class="stat-label">í‰ê·  í’ˆì§ˆ</div>
        </div>
      </div>
      <canvas id="sleepChart" width="400" height="200"></canvas>
    </div>

    <div class="card">
      <h2>ğŸ“… ìµœê·¼ ìˆ˜ë©´ ê¸°ë¡</h2>
      <ul id="sleepList" class="list">
        <li class="text-muted text-center">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</li>
      </ul>
    </div>
  </div>

  <!-- FOOD SCREEN -->
  <div id="screen-food" class="screen">
    <div class="card text-center">
      <div style="font-size: 4rem;">ğŸ¥—</div>
      <h2>ì˜¤ëŠ˜ ë­ ë¨¹ì„ê¹Œìš”?</h2>
      <p class="text-muted">AIê°€ 5,000+ ê±´ê°•ì‹ì„ ì¶”ì²œí•´ë“œë ¤ìš”.</p>
      
      <div class="food-result" id="foodResult">
        ì¶”ì²œì„ ë°›ì•„ë³´ì„¸ìš”
      </div>
      
      <div class="btn-group mt-2">
        <button class="btn btn-accent" onclick="app.food.recommend('#foodResult')">
          ğŸ² ëœë¤ ì¶”ì²œ
        </button>
        <button class="btn btn-secondary" onclick="app.food.recommendByCategory()">
          ğŸ“‹ ì¹´í…Œê³ ë¦¬ë³„
        </button>
      </div>
      
      <div id="categorySelection" class="hidden mt-2">
        <select id="foodCategory" class="mb-1">
          <option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
          <option value="í•œì‹">í•œì‹</option>
          <option value="ì–‘ì‹">ì–‘ì‹</option>
          <option value="ì¼ì‹">ì¼ì‹</option>
          <option value="ì¤‘ì‹">ì¤‘ì‹</option>
          <option value="ìƒëŸ¬ë“œ">ìƒëŸ¬ë“œ</option>
          <option value="ìˆ˜í”„">ìˆ˜í”„</option>
          <option value="ë¹„ê±´">ë¹„ê±´</option>
          <option value="ì €ì¹¼ë¡œë¦¬">ì €ì¹¼ë¡œë¦¬</option>
        </select>
        <button class="btn btn-primary" onclick="app.food.getCategoryFood()">ì¶”ì²œë°›ê¸°</button>
      </div>
    </div>

    <div class="card">
      <h2>â­ ì¦ê²¨ì°¾ê¸°</h2>
      <ul id="favoriteFoodList" class="list">
        <li class="text-muted text-center">ì¦ê²¨ì°¾ê¸°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</li>
      </ul>
      <button class="btn btn-secondary mt-1" onclick="app.food.addToFavorites()">
        í˜„ì¬ ìŒì‹ ì €ì¥
      </button>
    </div>
  </div>

  <!-- GAME SCREEN -->
  <div id="screen-game" class="screen">
    <div class="card">
      <h2>ğŸ§  ê±´ê°• ìƒì‹ í€´ì¦ˆ</h2>
      <div class="stat-grid mb-2">
        <div class="stat-card">
          <div class="stat-value" id="gameScore">0</div>
          <div class="stat-label">ì ìˆ˜</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="gameStreak">0</div>
          <div class="stat-label">ì—°ì† ì •ë‹µ</div>
        </div>
      </div>
      
      <div class="card" style="background: var(--bg);">
        <p id="gameQuestion" style="font-weight: 600; font-size: 1.1rem; min-height: 60px;">
          ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
        </p>
      </div>
      
      <input id="gameAnswer" type="text" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”" class="mb-1"
             onkeypress="if(event.key==='Enter') app.game.check()">
      
      <div class="btn-group">
        <button class="btn btn-primary" onclick="app.game.check()">âœ“ ì •ë‹µ í™•ì¸</button>
        <button class="btn btn-secondary" onclick="app.game.next()">â†’ ë‹¤ìŒ ë¬¸ì œ</button>
      </div>
      
      <div id="gameFeedback" class="mt-1" style="font-weight: 600; min-height: 24px;"></div>
      
      <div class="progress-bar mt-2">
        <div id="gameProgress" class="progress-fill" style="width: 0%"></div>
      </div>
      <p class="text-muted text-small text-center mt-1">
        600+ ë¬¸ì œ / AI ìƒì„± ë³€í˜• í¬í•¨
      </p>
    </div>

    <div class="card">
      <h2>ğŸ† ìµœê³  ê¸°ë¡</h2>
      <div class="stat-grid">
        <div class="stat-card">
          <div class="stat-value" id="bestScore">0</div>
          <div class="stat-label">ìµœê³  ì ìˆ˜</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="bestStreak">0</div>
          <div class="stat-label">ìµœëŒ€ ì—°ì†</div>
        </div>
      </div>
    </div>
  </div>

  <!-- CHAT SCREEN -->
  <div id="screen-chat" class="screen">
    <div class="card chat-container">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
        <h2 style="margin: 0;">ğŸ¤– AI ìƒë‹´ì‚¬</h2>
        <button class="btn btn-secondary" style="width: auto; padding: 8px 16px; font-size: 0.85rem;" 
                onclick="app.chat.clearHistory()">ëŒ€í™” ì´ˆê¸°í™”</button>
      </div>
      
      <div id="chatHistory" class="chat-history">
        <div class="chat-message ai">
          ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” AI ê±´ê°• ìƒë‹´ì‚¬ì…ë‹ˆë‹¤. ì˜¤ëŠ˜ í•˜ë£¨ëŠ” ì–´ë– ì…¨ë‚˜ìš”? í¸í•˜ê²Œ ì´ì•¼ê¸°í•´ ì£¼ì„¸ìš”. ğŸ˜Š
        </div>
      </div>
      
      <div class="typing-indicator" id="typingIndicator">
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
      </div>
      
      <div class="chat-input-container">
        <input id="chatInput" type="text" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." 
               onkeypress="if(event.key==='Enter') app.chat.send()">
        <button class="btn btn-primary" onclick="app.chat.send()" id="chatSendBtn">
          <span>â¤</span>
        </button>
      </div>
      
      <p class="text-muted text-small mt-1 text-center">
        ğŸ’¡ 10,000+ í‚¤ì›Œë“œë¡œ ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™” ì§€ì› | AI í•™ìŠµ ëª¨ë¸ ì ìš©
      </p>
    </div>
  </div>

  <!-- BOTTOM NAV -->
  <nav id="bottomNav" class="bottom-nav">
    <button class="nav-btn" data-screen="home" onclick="app.nav.go('home')" aria-label="í™ˆ">
      <span>ğŸ </span>í™ˆ
    </button>
    <button class="nav-btn" data-screen="mental" onclick="app.nav.go('mental')" aria-label="ë©˜íƒˆ ì¼€ì–´">
      <span>ğŸ’•</span>ë©˜íƒˆ
    </button>
    <button class="nav-btn" data-screen="sleep" onclick="app.nav.go('sleep')" aria-label="ìˆ˜ë©´ ê¸°ë¡">
      <span>ğŸŒ™</span>ìˆ˜ë©´
    </button>
    <button class="nav-btn" data-screen="food" onclick="app.nav.go('food')" aria-label="ê±´ê°• ì‹ë‹¨">
      <span>ğŸ¥—</span>ìŒì‹
    </button>
    <button class="nav-btn" data-screen="game" onclick="app.nav.go('game')" aria-label="ê±´ê°• í€´ì¦ˆ">
      <span>ğŸ®</span>ê²Œì„
    </button>
    <button class="nav-btn" data-screen="chat" onclick="app.nav.go('chat')" aria-label="AI ìƒë‹´">
      <span>ğŸ’¬</span>ìƒë‹´
    </button>
  </nav>

  <!-- NOTIFICATION -->
  <div id="notification" class="notification"></div>
</div>

<script>
// ========================================
// DATA STORAGE & GENERATION
// ========================================
const DATA = {
  foods: [],
  foodCategories: {},
  aiKeywordsByCategory: {},
  aiResponses: {},
  games: [],
  moodEmojis: {
    happy: 'ğŸ˜„', calm: 'ğŸ˜Œ', excited: 'ğŸ¤©', neutral: 'ğŸ˜',
    worried: 'ğŸ˜Ÿ', sad: 'ğŸ˜¢', angry: 'ğŸ˜¡', tired: 'ğŸ˜«', anxious: 'ğŸ˜°'
  }
};

// ========================================
// APP CORE
// ========================================
const app = {
  state: {
    user: null,
    currentGame: null,
    gameScore: 0,
    gameStreak: 0,
    currentFood: '',
    chatHistory: [],
    theme: 'light'
  },

  init: async function() {
    console.log('ğŸš€ ì•± ì´ˆê¸°í™” ì‹œì‘...');
    
    // ë°ì´í„° ìƒì„±
    await this.dataGenerator.initAll({
      foods: 5000,
      aiKeywords: 10000,
      games: 600
    });
    
    // í…Œë§ˆ ë¡œë“œ
    this.loadTheme();
    
    // ì¸ì¦ í™•ì¸
    this.auth.checkSession();
    
    // ê²Œì„ ì´ˆê¸°í™”
    this.game.loadStats();
    this.game.next();
    
    // ëª…ì–¸ ì„¤ì •
    this.setDailyQuote();
    
    // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸
    this.setupPWA();
    
    console.log('âœ… ì•± ì´ˆê¸°í™” ì™„ë£Œ');
    console.log('ğŸ“Š ë°ì´í„°:', {
      foods: DATA.foods.length,
      keywords: Object.values(DATA.aiKeywordsByCategory).flat().length,
      games: DATA.games.length
    });
  },

  // ========================================
  // THEME
  // ========================================
  toggleTheme: function() {
    const html = document.documentElement;
    const currentTheme = html.getAttribute('data-theme') || 'light';
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    
    html.setAttribute('data-theme', newTheme);
    this.state.theme = newTheme;
    localStorage.setItem('app_theme', newTheme);
    
    document.getElementById('themeIcon').textContent = newTheme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
    
    this.notify(newTheme === 'dark' ? 'ë‹¤í¬ ëª¨ë“œ í™œì„±í™”' : 'ë¼ì´íŠ¸ ëª¨ë“œ í™œì„±í™”', 'success');
  },

  loadTheme: function() {
    const saved = localStorage.getItem('app_theme') || 'light';
    this.state.theme = saved;
    document.documentElement.setAttribute('data-theme', saved);
    document.getElementById('themeIcon').textContent = saved === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
  },

  // ========================================
  // NOTIFICATIONS
  // ========================================
  notify: function(message, type = 'success') {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.className = `notification ${type} active`;
    
    setTimeout(() => {
      notification.classList.remove('active');
    }, 3000);
  },

  // ========================================
  // PWA
  // ========================================
  setupPWA: function() {
    if ('serviceWorker' in navigator) {
      // Service WorkerëŠ” ë³„ë„ íŒŒì¼ í•„ìš”ë¡œ ìƒëµ
      // ëŒ€ì‹  manifestë§Œ ì¸ë¼ì¸ìœ¼ë¡œ ì²˜ë¦¬
    }
    
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      // ì„¤ì¹˜ ë²„íŠ¼ í‘œì‹œ ê°€ëŠ¥
    });
  },

  // ========================================
  // AUTH
  // ========================================
  auth: {
    getUsers: () => JSON.parse(localStorage.getItem('app_users') || '{}'),
    saveUsers: users => localStorage.setItem('app_users', JSON.stringify(users)),
    
    hashPassword: async function(password) {
      const encoder = new TextEncoder();
      const data = encoder.encode(password);
      const hash = await crypto.subtle.digest('SHA-256', data);
      return Array.from(new Uint8Array(hash))
        .map(b => b.toString(16).padStart(2, '0')).join('');
    },

    signup: async function() {
      const id = document.getElementById('regId').value.trim();
      const pw = document.getElementById('regPw').value.trim();
      const age = document.getElementById('regAge').value.trim();
      const msgEl = document.getElementById('authMsg');
      
      msgEl.textContent = '';
      
      if (!id || !pw) {
        msgEl.textContent = 'âš ï¸ ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
        return;
      }
      
      if (pw.length < 4) {
        msgEl.textContent = 'âš ï¸ ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
        return;
      }
      
      const users = this.getUsers();
      if (users[id]) {
        msgEl.textContent = 'âš ï¸ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.';
        return;
      }
      
      const hashedPw = await this.hashPassword(pw);
      users[id] = {
        pw: hashedPw,
        age: age || null,
        joinDate: new Date().toISOString()
      };
      
      this.saveUsers(users);
      app.notify('âœ… íšŒì›ê°€ì… ì™„ë£Œ! ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.', 'success');
      app.ui.toggleSignup(false);
      
      // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
      document.getElementById('regId').value = '';
      document.getElementById('regPw').value = '';
      document.getElementById('regAge').value = '';
    },

    login: async function() {
      const id = document.getElementById('loginId').value.trim();
      const pw = document.getElementById('loginPw').value.trim();
      const users = this.getUsers();
      const msgEl = document.getElementById('authMsg');
      
      msgEl.textContent = '';
      
      if (!id || !pw) {
        msgEl.textContent = 'âš ï¸ ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
        return;
      }
      
      const hashedPw = await this.hashPassword(pw);
      
      if (users[id] && users[id].pw === hashedPw) {
        app.state.user = { id, ...users[id] };
        localStorage.setItem('app_current_user', JSON.stringify(app.state.user));
        app.ui.onLoginSuccess();
        app.notify('ğŸ‰ ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
      } else {
        msgEl.textContent = 'âŒ ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.';
      }
    },

    logout: function() {
      if (!confirm('ì •ë§ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      app.state.user = null;
      localStorage.removeItem('app_current_user');
      app.notify('ğŸ‘‹ ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
      
      setTimeout(() => {
        location.reload();
      }, 1000);
    },

    checkSession: function() {
      const saved = localStorage.getItem('app_current_user');
      if (saved) {
        try {
          app.state.user = JSON.parse(saved);
          app.ui.onLoginSuccess();
        } catch (e) {
          console.error('ì„¸ì…˜ ë³µì› ì‹¤íŒ¨:', e);
          localStorage.removeItem('app_current_user');
        }
      }
    }
  },

  // ========================================
  // UI
  // ========================================
  ui: {
    toggleSignup: function(show) {
      document.getElementById('loginBox').classList.toggle('hidden', show);
      document.getElementById('signupBox').classList.toggle('hidden', !show);
      document.getElementById('authMsg').textContent = '';
    },

    onLoginSuccess: function() {
      const user = app.state.user;
      document.getElementById('userNameDisplay').textContent = user.id;
      document.getElementById('bottomNav').classList.add('active');
      
      // ê°€ì…ì¼ë¡œë¶€í„° ê²½ê³¼ì¼ ê³„ì‚°
      const joinDate = new Date(user.joinDate);
      const today = new Date();
      const dayCount = Math.floor((today - joinDate) / (1000 * 60 * 60 * 24));
      document.getElementById('homeDayCount').textContent = dayCount;
      
      // ê¸°ë¶„ ê¸°ë¡ ê°œìˆ˜
      const moodHistory = JSON.parse(localStorage.getItem(`mood_history_${user.id}`) || '[]');
      document.getElementById('homeMoodCount').textContent = moodHistory.length;
      
      // í˜„ì¬ ê¸°ë¶„ í‘œì‹œ
      app.mental.loadCurrentMood();
      
      // ìˆ˜ë©´ ë°ì´í„° ë¡œë“œ
      app.sleep.load();
      
      // ì°¨íŠ¸ ë Œë”ë§
      app.mental.renderChart();
      app.sleep.renderChart();
      
      app.nav.go('home');
    }
  },

  // ========================================
  // NAVIGATION
  // ========================================
  nav: {
    go: function(screenId) {
      if (screenId !== 'login' && !app.state.user) {
        app.notify('âš ï¸ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'warning');
        return app.nav.go('login');
      }
      
      // í™”ë©´ ì „í™˜
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      const target = document.getElementById('screen-' + screenId);
      if (target) target.classList.add('active');
      
      // í—¤ë” íƒ€ì´í‹€
      const titles = {
        home: 'í™ˆ',
        mental: 'ë©˜íƒˆ ì¼€ì–´',
        sleep: 'ìˆ˜ë©´ ê¸°ë¡',
        food: 'ê±´ê°• ì‹ë‹¨',
        game: 'ê±´ê°• í€´ì¦ˆ',
        chat: 'AI ìƒë‹´',
        login: 'ë§ˆìŒ ì±™ê¹€ & ê±´ê°• íŒŒíŠ¸ë„ˆ Pro'
      };
      document.getElementById('headerTitle').textContent = titles[screenId] || 'ê±´ê°• ê´€ë¦¬';
      
      // ë„¤ë¹„ í™œì„±í™”
      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
      const btn = document.querySelector(`.nav-btn[data-screen="${screenId}"]`);
      if (btn) btn.classList.add('active');
      
      // í™”ë©´ë³„ ì´ˆê¸°í™”
      if (screenId === 'mental') {
        app.mental.renderChart();
        app.mental.renderHistory();
      } else if (screenId === 'sleep') {
        app.sleep.renderChart();
      } else if (screenId === 'food') {
        app.food.loadFavorites();
      }
    }
  },

  // ========================================
  // MENTAL (ê°ì • ê¸°ë¡)
  // ========================================
  mental: {
    setMood: function(mood) {
      if (!app.state.user) return;
      
      const responses = {
        happy: [
          "ê¸ì • ì—ë„ˆì§€ê°€ ë„˜ì¹˜ë„¤ìš”! âœ¨ ì´ ê¸°ë¶„ì„ ì£¼ë³€ ì‚¬ëŒë“¤ê³¼ ë‚˜ëˆ ë³´ì„¸ìš”.",
          "ì˜¤ëŠ˜ì´ ì°¸ ì¢‹ì€ ë‚ ì´ë„¤ìš”! ğŸ˜Š ê³„ì† ì›ƒìœ¼ë©° í•˜ë£¨ë¥¼ ë³´ë‚´ì„¸ìš”.",
          "í–‰ë³µí•œ ê°ì •ì€ ì „ì—¼ë©ë‹ˆë‹¤! ì£¼ë³€ì— ì¢‹ì€ ì˜í–¥ì„ ì£¼ê³  ìˆì–´ìš”."
        ],
        calm: [
          "í‰ì˜¨í•¨ì€ í° ì„ ë¬¼ì…ë‹ˆë‹¤. ğŸ˜Œ ê¹Šê²Œ ìˆ¨ì„ ì‰¬ë©° ì´ ìˆœê°„ì„ ì¦ê²¨ë³´ì„¸ìš”.",
          "ì°¨ë¶„í•œ ë§ˆìŒìœ¼ë¡œ ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ì²œì²œíˆ ê³„íší•´ë³´ì„¸ìš”.",
          "ë‚´ë©´ì˜ í‰í™”ë¥¼ ëŠë¼ê³  ê³„ì‹œë„¤ìš”. ì´ ìƒíƒœë¥¼ ìœ ì§€í•´ë³´ì„¸ìš”."
        ],
        excited: [
          "ì‹ ë‚˜ëŠ” ì¼ì´ ìˆìœ¼ì‹ ê°€ìš”? ğŸ¤© ê·¸ ì—ë„ˆì§€ë¡œ ë©‹ì§„ ì¼ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!",
          "ì—´ì •ì ì¸ ëª¨ìŠµì´ ë³´ê¸° ì¢‹ìŠµë‹ˆë‹¤! ê¸ì •ì ì¸ ì—ë„ˆì§€ë¥¼ ì˜ í™œìš©í•˜ì„¸ìš”.",
          "ë“¤ëœ¬ ë§ˆìŒì„ ì¢‹ì€ ë°©í–¥ìœ¼ë¡œ ì‚¬ìš©í•´ë³´ì„¸ìš”. ìƒˆë¡œìš´ ë„ì „ë„ ì¢‹ìŠµë‹ˆë‹¤!"
        ],
        neutral: [
          "ë¬´ë‚œí•œ í•˜ë£¨ë„ ì†Œì¤‘í•©ë‹ˆë‹¤. ê°€ë²¼ìš´ ì‚°ì±…ì„ ì¶”ì²œí•´ìš”. ğŸš¶",
          "ì˜¤ëŠ˜ì˜ ì‘ì€ ì„±ì·¨ í•˜ë‚˜ë¥¼ ë§Œë“¤ì–´ë³´ëŠ” ê±´ ì–´ë–¨ê¹Œìš”?",
          "í‰ë²”í•¨ ì†ì—ì„œë„ ê°ì‚¬í•  ê²ƒë“¤ì„ ì°¾ì•„ë³´ì„¸ìš”."
        ],
        worried: [
          "ê±±ì •ì´ ë§ìœ¼ì‹ ê°€ìš”? ğŸ˜Ÿ ê¹Šì€ í˜¸í¡ì„ í•´ë³´ì„¸ìš”. ëª¨ë“  ê²ƒì€ ì§€ë‚˜ê°‘ë‹ˆë‹¤.",
          "ê±±ì •ì„ ì¢…ì´ì— ì ì–´ë³´ì„¸ìš”. ìƒê°ì´ ì •ë¦¬ë  ê±°ì˜ˆìš”.",
          "ê±±ì •ì˜ ëŒ€ë¶€ë¶„ì€ ì¼ì–´ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í˜„ì¬ì— ì§‘ì¤‘í•´ë³´ì„¸ìš”."
        ],
        sad: [
          "ê´œì°®ì•„ìš”. í˜¼ìê°€ ì•„ë‹ˆì—ìš”. ğŸ˜¢ ë”°ëœ»í•œ ì°¨ í•œ ì” ì–´ë– ì„¸ìš”?",
          "ìŠ¬í””ë„ ìì—°ìŠ¤ëŸ¬ìš´ ê°ì •ì…ë‹ˆë‹¤. ì¶©ë¶„íˆ ëŠë¼ê³  í‘œí˜„í•˜ì„¸ìš”.",
          "í˜ë“  ì‹œê°„ì€ ì§€ë‚˜ê°‘ë‹ˆë‹¤. ì‘ì€ ì‚°ì±…ì´ë‚˜ ì¢‹ì•„í•˜ëŠ” ìŒì•…ì„ ë“¤ì–´ë³´ì„¸ìš”."
        ],
        angry: [
          "í™”ê°€ ë‚˜ì‹¤ ë•ŒëŠ” ì ì‹œ ë©ˆì¶”ê³  ê¹Šê²Œ ìˆ¨ì„ ì‰¬ì–´ë³´ì„¸ìš”. ğŸ˜¡",
          "í•œ ê±¸ìŒ ë–¨ì–´ì ¸ì„œ ìƒí™©ì„ ë°”ë¼ë³´ë©´ ë„ì›€ì´ ë©ë‹ˆë‹¤.",
          "ê²©í•œ ê°ì •ì€ ì‹œê°„ì´ ì§€ë‚˜ë©´ ê°€ë¼ì•‰ìŠµë‹ˆë‹¤. ì§„ì •í•  ì‹œê°„ì„ ê°€ì§€ì„¸ìš”."
        ],
        tired: [
          "ë§ì´ í”¼ê³¤í•˜ì‹œêµ°ìš”. ğŸ˜« 15-20ë¶„ ë‚®ì ì´ í° ë„ì›€ì´ ë©ë‹ˆë‹¤.",
          "ìˆ˜ë¶„ì„ ì¶©ë¶„íˆ ì„­ì·¨í•˜ê³  ê°€ë²¼ìš´ ìŠ¤íŠ¸ë ˆì¹­ì„ í•´ë³´ì„¸ìš”.",
          "ëª¸ì´ ë³´ë‚´ëŠ” ì‹ í˜¸ì…ë‹ˆë‹¤. ì¶©ë¶„í•œ íœ´ì‹ì„ ì·¨í•˜ì„¸ìš”."
        ],
        anxious: [
          "ë¶ˆì•ˆí•œ ë§ˆìŒì´ ë“œì‹œë‚˜ìš”? ğŸ˜° 4-7-8 í˜¸í¡ë²•ì„ ì‹œë„í•´ë³´ì„¸ìš”.",
          "ë¶ˆì•ˆì€ ë¯¸ë˜ì— ëŒ€í•œ ê±±ì •ì…ë‹ˆë‹¤. ì§€ê¸ˆ ì´ ìˆœê°„ì— ì§‘ì¤‘í•´ë³´ì„¸ìš”.",
          "ë¶ˆì•ˆí•  ë•ŒëŠ” í•  ìˆ˜ ìˆëŠ” ì‘ì€ ì¼ë¶€í„° í•˜ë‚˜ì”© í•´ê²°í•´ë³´ì„¸ìš”."
        ]
      };
      
      const messages = responses[mood] || ["ì§€ê¸ˆì˜ ê°ì •ì„ ì˜ ì‚´í´ë³´ì„¸ìš”."];
      const message = messages[Math.floor(Math.random() * messages.length)];
      
      // UI ì—…ë°ì´íŠ¸
      document.getElementById('moodResultCard').classList.remove('hidden');
      document.getElementById('moodComment').innerHTML = `<strong>${message}</strong>`;
      
      // ê¸°ë¡ ì €ì¥
      const key = `mood_history_${app.state.user.id}`;
      const history = JSON.parse(localStorage.getItem(key) || '[]');
      history.unshift({
        date: new Date().toISOString(),
        mood: mood,
        emoji: DATA.moodEmojis[mood]
      });
      
      if (history.length > 100) history.pop();
      localStorage.setItem(key, JSON.stringify(history));
      
      // í˜„ì¬ ê¸°ë¶„ ì €ì¥
      localStorage.setItem(`mood_${app.state.user.id}`, mood);
      
      // í™ˆ í™”ë©´ ì—…ë°ì´íŠ¸
      this.loadCurrentMood();
      
      // í†µê³„ ì—…ë°ì´íŠ¸
      document.getElementById('homeMoodCount').textContent = history.length;
      
      // ì°¨íŠ¸ ë Œë”ë§
      this.renderChart();
      this.renderHistory();
      
      app.notify('âœ… ê¸°ë¶„ì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
    },

    loadCurrentMood: function() {
      if (!app.state.user) return;
      
      const mood = localStorage.getItem(`mood_${app.state.user.id}`);
      const display = document.getElementById('homeMoodDisplay');
      
      if (mood && DATA.moodEmojis[mood]) {
        display.textContent = `${DATA.moodEmojis[mood]} ${mood.toUpperCase()}`;
      } else {
        display.textContent = 'ê¸°ë¡ ì—†ìŒ';
      }
    },

    renderChart: function() {
      if (!app.state.user) return;
      
      const canvas = document.getElementById('moodChart');
      if (!canvas) return;
      
      const ctx = canvas.getContext('2d');
      const history = JSON.parse(localStorage.getItem(`mood_history_${app.state.user.id}`) || '[]');
      
      // ìµœê·¼ 7ì¼ ë°ì´í„°
      const last7Days = [];
      for (let i = 6; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        const dateStr = date.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' });
        last7Days.push({ date: dateStr, moods: {} });
      }
      
      // ë°ì´í„° ì§‘ê³„
      history.forEach(record => {
        const recordDate = new Date(record.date).toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' });
        const dayData = last7Days.find(d => d.date === recordDate);
        if (dayData) {
          dayData.moods[record.mood] = (dayData.moods[record.mood] || 0) + 1;
        }
      });
      
      // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
      const width = canvas.width;
      const height = canvas.height;
      const padding = 40;
      const chartWidth = width - padding * 2;
      const chartHeight = height - padding * 2;
      
      ctx.clearRect(0, 0, width, height);
      
      // ë°°ê²½
      const isDark = app.state.theme === 'dark';
      ctx.fillStyle = isDark ? '#1f2937' : '#f9fafb';
      ctx.fillRect(0, 0, width, height);
      
      // ê²©ì
      ctx.strokeStyle = isDark ? '#374151' : '#e5e7eb';
      ctx.lineWidth = 1;
      for (let i = 0; i <= 5; i++) {
        const y = padding + (chartHeight / 5) * i;
        ctx.beginPath();
        ctx.moveTo(padding, y);
        ctx.lineTo(width - padding, y);
        ctx.stroke();
      }
      
      // ë§‰ëŒ€ ê·¸ë¦¬ê¸°
      const barWidth = chartWidth / last7Days.length / 1.5;
      const maxCount = Math.max(...last7Days.map(d => Object.values(d.moods).reduce((a, b) => a + b, 0))) || 1;
      
      last7Days.forEach((day, index) => {
        const x = padding + (chartWidth / last7Days.length) * index + (chartWidth / last7Days.length - barWidth) / 2;
        const totalCount = Object.values(day.moods).reduce((a, b) => a + b, 0);
        const barHeight = (totalCount / maxCount) * chartHeight;
        
        // ë§‰ëŒ€
        const gradient = ctx.createLinearGradient(x, height - padding - barHeight, x, height - padding);
        gradient.addColorStop(0, '#6366f1');
        gradient.addColorStop(1, '#8b5cf6');
        
        ctx.fillStyle = gradient;
        ctx.fillRect(x, height - padding - barHeight, barWidth, barHeight);
        
        // ë‚ ì§œ ë ˆì´ë¸”
        ctx.fillStyle = isDark ? '#9ca3af' : '#6b7280';
        ctx.font = '10px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(day.date, x + barWidth / 2, height - padding + 20);
        
        // ê°œìˆ˜ í‘œì‹œ
        if (totalCount > 0) {
          ctx.fillStyle = isDark ? '#f9fafb' : '#1f2937';
          ctx.font = 'bold 12px sans-serif';
          ctx.fillText(totalCount, x + barWidth / 2, height - padding - barHeight - 5);
        }
      });
      
      // ì œëª©
      ctx.fillStyle = isDark ? '#f9fafb' : '#1f2937';
      ctx.font = 'bold 14px sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('ì¼ë³„ ê¸°ë¶„ ê¸°ë¡ íšŸìˆ˜', width / 2, 20);
    },

    renderHistory: function() {
      if (!app.state.user) return;
      
      const list = document.getElementById('moodHistoryList');
      const history = JSON.parse(localStorage.getItem(`mood_history_${app.state.user.id}`) || '[]');
      
      if (history.length === 0) {
        list.innerHTML = '<li class="text-muted text-center">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
        return;
      }
      
      list.innerHTML = history.slice(0, 10).map(record => {
        const date = new Date(record.date);
        const dateStr = date.toLocaleDateString('ko-KR', {
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
        
        return `
          <li class="list-item">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <span style="font-size: 1.5rem; margin-right: 8px;">${record.emoji}</span>
                <span style="font-weight: 600;">${record.mood.toUpperCase()}</span>
              </div>
              <div class="text-muted text-small">${dateStr}</div>
            </div>
          </li>
        `;
      }).join('');
    }
  },

  // ========================================
  // SLEEP (ìˆ˜ë©´ ê¸°ë¡)
  // ========================================
  sleep: {
    save: function() {
      if (!app.state.user) {
        app.notify('âš ï¸ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'warning');
        return;
      }
      
      const sleepTime = document.getElementById('sleepTime').value;
      const sleepAmpm = document.getElementById('sleepAmpm').value;
      const wakeTime = document.getElementById('wakeTime').value;
      const wakeAmpm = document.getElementById('wakeAmpm').value;
      const quality = parseInt(document.getElementById('sleepQuality').value);
      
      if (!sleepTime || !wakeTime) {
        app.notify('âš ï¸ ì‹œê°„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
        return;
      }
      
      // ì‹œê°„ì„ 24ì‹œê°„ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
      const to24Hour = (time, ampm) => {
        const [hh, mm] = time.split(':').map(Number);
        let hour = hh;
        if (ampm === 'PM' && hh < 12) hour = hh + 12;
        if (ampm === 'AM' && hh === 12) hour = 0;
        return hour * 60 + mm;
      };
      
      const startMin = to24Hour(sleepTime, sleepAmpm);
      const endMin = to24Hour(wakeTime, wakeAmpm);
      
      // ìˆ˜ë©´ ì‹œê°„ ê³„ì‚° (overnight ê³ ë ¤)
      let durationMin = endMin - startMin;
      if (durationMin <= 0) durationMin += 24 * 60;
      
      const hours = Math.floor(durationMin / 60);
      const mins = durationMin % 60;
      
      const log = {
        date: new Date().toISOString(),
        dateStr: new Date().toLocaleDateString('ko-KR'),
        start: `${sleepTime} ${sleepAmpm === 'PM' ? 'ì˜¤í›„' : 'ì˜¤ì „'}`,
        end: `${wakeTime} ${wakeAmpm === 'PM' ? 'ì˜¤í›„' : 'ì˜¤ì „'}`,
        duration: `${hours}ì‹œê°„ ${mins}ë¶„`,
        durationHours: hours + mins / 60,
        quality: quality
      };
      
      const key = `sleep_${app.state.user.id}`;
      const logs = JSON.parse(localStorage.getItem(key) || '[]');
      logs.unshift(log);
      
      if (logs.length > 30) logs.pop();
      localStorage.setItem(key, JSON.stringify(logs));
      
      this.renderLogs(logs);
      this.renderChart();
      this.updateStats();
      
      app.notify('âœ… ìˆ˜ë©´ ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤ ğŸŒ™', 'success');
    },

    load: function() {
      if (!app.state.user) return;
      
      const key = `sleep_${app.state.user.id}`;
      const logs = JSON.parse(localStorage.getItem(key) || '[]');
      this.renderLogs(logs);
      this.updateStats();
    },

    renderLogs: function(logs) {
      const list = document.getElementById('sleepList');
      
      if (!logs || logs.length === 0) {
        list.innerHTML = '<li class="text-muted text-center">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
        return;
      }
      
      list.innerHTML = logs.slice(0, 10).map(log => `
        <li class="list-item">
          <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
            <strong style="color: var(--primary);">${log.dateStr}</strong>
            <span class="badge ${log.quality >= 7 ? 'accent' : log.quality >= 4 ? '' : 'danger'}">
              í’ˆì§ˆ: ${log.quality}/10
            </span>
          </div>
          <div class="text-muted text-small">
            ğŸ›Œ ${log.start} â†’ â˜€ï¸ ${log.end}
          </div>
          <div style="margin-top: 4px;">
            <strong>â±ï¸ ${log.duration}</strong>
          </div>
        </li>
      `).join('');
    },

    updateStats: function() {
      if (!app.state.user) return;
      
      const key = `sleep_${app.state.user.id}`;
      const logs = JSON.parse(localStorage.getItem(key) || '[]');
      const last7 = logs.slice(0, 7);
      
      if (last7.length === 0) {
        document.getElementById('avgSleepHours').textContent = '0h';
        document.getElementById('avgSleepQuality').textContent = '0';
        return;
      }
      
      const avgHours = last7.reduce((sum, log) => sum + log.durationHours, 0) / last7.length;
      const avgQuality = last7.reduce((sum, log) => sum + log.quality, 0) / last7.length;
      
      document.getElementById('avgSleepHours').textContent = `${avgHours.toFixed(1)}h`;
      document.getElementById('avgSleepQuality').textContent = `${avgQuality.toFixed(1)}/10`;
    },

    renderChart: function() {
      if (!app.state.user) return;
      
      const canvas = document.getElementById('sleepChart');
      if (!canvas) return;
      
      const ctx = canvas.getContext('2d');
      const logs = JSON.parse(localStorage.getItem(`sleep_${app.state.user.id}`) || '[]');
      const last7 = logs.slice(0, 7).reverse();
      
      const width = canvas.width;
      const height = canvas.height;
      const padding = 40;
      const chartWidth = width - padding * 2;
      const chartHeight = height - padding * 2;
      
      ctx.clearRect(0, 0, width, height);
      
      // ë°°ê²½
      const isDark = app.state.theme === 'dark';
      ctx.fillStyle = isDark ? '#1f2937' : '#f9fafb';
      ctx.fillRect(0, 0, width, height);
      
      if (last7.length === 0) {
        ctx.fillStyle = isDark ? '#9ca3af' : '#6b7280';
        ctx.font = '14px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤', width / 2, height / 2);
        return;
      }
      
      // ê²©ì
      ctx.strokeStyle = isDark ? '#374151' : '#e5e7eb';
      ctx.lineWidth = 1;
      for (let i = 0; i <= 4; i++) {
        const y = padding + (chartHeight / 4) * i;
        ctx.beginPath();
        ctx.moveTo(padding, y);
        ctx.lineTo(width - padding, y);
        ctx.stroke();
      }
      
      // ë¼ì¸ ê·¸ë¦¬ê¸°
      const maxHours = 12;
      ctx.beginPath();
      ctx.strokeStyle = '#6366f1';
      ctx.lineWidth = 3;
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
      
      last7.forEach((log, index) => {
        const x = padding + (chartWidth / (last7.length - 1)) * index;
        const y = height - padding - (log.durationHours / maxHours) * chartHeight;
        
        if (index === 0) {
          ctx.moveTo(x, y);
        } else {
          ctx.lineTo(x, y);
        }
      });
      ctx.stroke();
      
      // í¬ì¸íŠ¸ ê·¸ë¦¬ê¸°
      last7.forEach((log, index) => {
        const x = padding + (chartWidth / (last7.length - 1)) * index;
        const y = height - padding - (log.durationHours / maxHours) * chartHeight;
        
        // í¬ì¸íŠ¸
        ctx.fillStyle = '#6366f1';
        ctx.beginPath();
        ctx.arc(x, y, 5, 0, Math.PI * 2);
        ctx.fill();
        
        // ì™¸ê³½ì„ 
        ctx.strokeStyle = isDark ? '#1f2937' : '#ffffff';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        // ê°’ í‘œì‹œ
        ctx.fillStyle = isDark ? '#f9fafb' : '#1f2937';
        ctx.font = 'bold 11px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(`${log.durationHours.toFixed(1)}h`, x, y - 12);
        
        // ë‚ ì§œ
        const date = new Date(log.date);
        const dateStr = date.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' });
        ctx.fillStyle = isDark ? '#9ca3af' : '#6b7280';
        ctx.font = '10px sans-serif';
        ctx.fillText(dateStr, x, height - padding + 20);
      });
      
      // Yì¶• ë ˆì´ë¸”
      ctx.fillStyle = isDark ? '#9ca3af' : '#6b7280';
      ctx.font = '10px sans-serif';
      ctx.textAlign = 'right';
      for (let i = 0; i <= 4; i++) {
        const y = padding + (chartHeight / 4) * i;
        const hours = maxHours - (maxHours / 4) * i;
        ctx.fillText(`${hours}h`, padding - 10, y + 4);
      }
      
      // ì œëª©
      ctx.fillStyle = isDark ? '#f9fafb' : '#1f2937';
      ctx.font = 'bold 14px sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('ìˆ˜ë©´ ì‹œê°„ ì¶”ì´', width / 2, 20);
    }
  },

  // ========================================
  // FOOD (ìŒì‹ ì¶”ì²œ)
  // ========================================
  food: {
    recommend: function(selector = '#foodResult') {
      if (DATA.foods.length === 0) return;
      
      const element = document.querySelector(selector);
      if (!element) return;
      
      // ì• ë‹ˆë©”ì´ì…˜
      element.classList.add('animating');
      
      setTimeout(() => {
        const food = DATA.foods[Math.floor(Math.random() * DATA.foods.length)];
        app.state.currentFood = food;
        element.textContent = food;
        element.classList.remove('animating');
      }, 250);
    },

    recommendByCategory: function() {
      const selection = document.getElementById('categorySelection');
      selection.classList.toggle('hidden');
    },

    getCategoryFood: function() {
      const category = document.getElementById('foodCategory').value;
      if (!category) {
        app.notify('âš ï¸ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
        return;
      }
      
      const foods = DATA.foodCategories[category] || [];
      if (foods.length === 0) {
        app.notify('âš ï¸ í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì— ìŒì‹ì´ ì—†ìŠµë‹ˆë‹¤.', 'warning');
        return;
      }
      
      const food = foods[Math.floor(Math.random() * foods.length)];
      app.state.currentFood = food;
      document.getElementById('foodResult').textContent = food;
      app.notify('âœ… ì¶”ì²œ ì™„ë£Œ!', 'success');
    },

    addToFavorites: function() {
      if (!app.state.user) {
        app.notify('âš ï¸ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'warning');
        return;
      }
      
      const food = app.state.currentFood;
      if (!food) {
        app.notify('âš ï¸ ë¨¼ì € ìŒì‹ì„ ì¶”ì²œë°›ìœ¼ì„¸ìš”.', 'warning');
        return;
      }
      
      const key = `favorites_${app.state.user.id}`;
      const favorites = JSON.parse(localStorage.getItem(key) || '[]');
      
      if (favorites.includes(food)) {
        app.notify('âš ï¸ ì´ë¯¸ ì¦ê²¨ì°¾ê¸°ì— ìˆìŠµë‹ˆë‹¤.', 'warning');
        return;
      }
      
      favorites.unshift(food);
      if (favorites.length > 20) favorites.pop();
      localStorage.setItem(key, JSON.stringify(favorites));
      
      this.loadFavorites();
      app.notify('â­ ì¦ê²¨ì°¾ê¸°ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
    },

    loadFavorites: function() {
      if (!app.state.user) return;
      
      const key = `favorites_${app.state.user.id}`;
      const favorites = JSON.parse(localStorage.getItem(key) || '[]');
      const list = document.getElementById('favoriteFoodList');
      
      if (favorites.length === 0) {
        list.innerHTML = '<li class="text-muted text-center">ì¦ê²¨ì°¾ê¸°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</li>';
        return;
      }
      
      list.innerHTML = favorites.map((food, index) => `
        <li class="list-item" style="display: flex; justify-content: space-between; align-items: center;">
          <span>${food}</span>
          <button class="btn btn-danger" style="width: auto; padding: 6px 12px; font-size: 0.85rem;"
                  onclick="app.food.removeFavorite(${index})">ì‚­ì œ</button>
        </li>
      `).join('');
    },

    removeFavorite: function(index) {
      if (!app.state.user) return;
      
      const key = `favorites_${app.state.user.id}`;
      const favorites = JSON.parse(localStorage.getItem(key) || '[]');
      favorites.splice(index, 1);
      localStorage.setItem(key, JSON.stringify(favorites));
      
      this.loadFavorites();
      app.notify('âœ… ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
    }
  },

  // ========================================
  // GAME (í€´ì¦ˆ)
  // ========================================
  game: {
    next: function() {
      if (DATA.games.length === 0) return;
      
      app.state.currentGame = DATA.games[Math.floor(Math.random() * DATA.games.length)];
      document.getElementById('gameQuestion').textContent = "Q. " + app.state.currentGame.q;
      document.getElementById('gameAnswer').value = '';
      document.getElementById('gameFeedback').textContent = '';
      
      this.updateProgress();
    },

    check: function() {
      const input = (document.getElementById('gameAnswer').value || '').trim().toLowerCase();
      const game = app.state.currentGame;
      const feedback = document.getElementById('gameFeedback');
      
      if (!game) {
        feedback.textContent = 'âš ï¸ ë¬¸ì œë¥¼ ë¨¼ì € ë¶ˆëŸ¬ì˜¤ì„¸ìš”.';
        feedback.style.color = 'var(--warning)';
        return;
      }
      
      if (!input) {
        feedback.textContent = 'âš ï¸ ë‹µì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
        feedback.style.color = 'var(--warning)';
        return;
      }
      
      const answers = game.a.map(a => a.toString().toLowerCase());
      const isCorrect = answers.some(a => input.includes(a) || a.includes(input));
      
      if (isCorrect) {
        app.state.gameScore += 10;
        app.state.gameStreak += 1;
        feedback.textContent = `âœ… ì •ë‹µì…ë‹ˆë‹¤! +10ì  (ì—°ì† ${app.state.gameStreak}íšŒ)`;
        feedback.style.color = 'var(--accent)';
        app.notify('ğŸ‰ ì •ë‹µ!', 'success');
      } else {
        app.state.gameStreak = 0;
        feedback.textContent = `âŒ ì˜¤ë‹µì…ë‹ˆë‹¤. ì •ë‹µì€ "${game.a[0]}"ì…ë‹ˆë‹¤.`;
        feedback.style.color = 'var(--danger)';
      }
      
      this.updateScore();
      this.saveStats();
      
      // ìë™ìœ¼ë¡œ ë‹¤ìŒ ë¬¸ì œ
      setTimeout(() => this.next(), 2000);
    },

    updateScore: function() {
      document.getElementById('gameScore').textContent = app.state.gameScore;
      document.getElementById('gameStreak').textContent = app.state.gameStreak;
    },

    updateProgress: function() {
      // ì„ì˜ë¡œ ì§„í–‰ë¥  í‘œì‹œ (ì‹¤ì œë¡œëŠ” ë¬¸ì œ ê°œìˆ˜ ê¸°ë°˜)
      const totalGames = DATA.games.length;
      const answeredGames = Math.min(app.state.gameScore / 10, totalGames);
      const progress = (answeredGames / totalGames) * 100;
      document.getElementById('gameProgress').style.width = `${Math.min(progress, 100)}%`;
    },

    saveStats: function() {
      if (!app.state.user) return;
      
      const key = `game_stats_${app.state.user.id}`;
      const stats = JSON.parse(localStorage.getItem(key) || '{"bestScore":0,"bestStreak":0}');
      
      if (app.state.gameScore > stats.bestScore) {
        stats.bestScore = app.state.gameScore;
      }
      if (app.state.gameStreak > stats.bestStreak) {
        stats.bestStreak = app.state.gameStreak;
      }
      
      localStorage.setItem(key, JSON.stringify(stats));
      
      document.getElementById('bestScore').textContent = stats.bestScore;
      document.getElementById('bestStreak').textContent = stats.bestStreak;
    },

    loadStats: function() {
      if (!app.state.user) return;
      
      const key = `game_stats_${app.state.user.id}`;
      const stats = JSON.parse(localStorage.getItem(key) || '{"bestScore":0,"bestStreak":0}');
      
      document.getElementById('bestScore').textContent = stats.bestScore;
      document.getElementById('bestStreak').textContent = stats.bestStreak;
    }
  },

  // ========================================
  // CHAT (AI ìƒë‹´)
  // ========================================
  chat: {
    send: async function() {
      const input = document.getElementById('chatInput');
      const message = (input.value || '').trim();
      
      if (!message) return;
      
      // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
      this.addMessage(message, 'user');
      input.value = '';
      
      // íƒ€ì´í•‘ í‘œì‹œ
      const typingIndicator = document.getElementById('typingIndicator');
      typingIndicator.classList.add('active');
      
      // ë²„íŠ¼ ë¹„í™œì„±í™”
      const sendBtn = document.getElementById('chatSendBtn');
      sendBtn.disabled = true;
      
      // AI ì‘ë‹µ ìƒì„±
      try {
        const response = await this.getAIResponse(message);
        
        setTimeout(() => {
          typingIndicator.classList.remove('active');
          this.addMessage(response, 'ai');
          sendBtn.disabled = false;
        }, 500 + Math.random() * 1000);
        
      } catch (error) {
        typingIndicator.classList.remove('active');
        this.addMessage('ì£„ì†¡í•©ë‹ˆë‹¤. ì‘ë‹µ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'ai');
        sendBtn.disabled = false;
      }
    },

    addMessage: function(text, type) {
      const div = document.createElement('div');
      div.className = `chat-message ${type}`;
      div.textContent = text;
      
      const history = document.getElementById('chatHistory');
      history.appendChild(div);
      history.scrollTop = history.scrollHeight;
      
      // íˆìŠ¤í† ë¦¬ ì €ì¥
      app.state.chatHistory.push({ text, type, timestamp: Date.now() });
      if (app.state.chatHistory.length > 50) app.state.chatHistory.shift();
    },

    getAIResponse: async function(userMsg) {
      const txt = userMsg.toLowerCase();
      
      // 1. ìœ„ê¸‰ ìƒí™© ê°ì§€
      const emergencyKeywords = ['ìì‚´', 'ì£½ê³ ì‹¶', 'ì‚´ê³ ì‹¶ì§€', 'ëë‚´ê³ ì‹¶', 'ì£½ì„ë˜', 'ìí•´'];
      if (emergencyKeywords.some(k => txt.includes(k))) {
        return "âš ï¸ ë§¤ìš° ìœ„ì¤‘í•œ í‘œí˜„ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¹ì‹ ì€ ì†Œì¤‘í•œ ì¡´ì¬ì…ë‹ˆë‹¤.\n\nì§€ê¸ˆ ì¦‰ì‹œ ë„ì›€ì´ í•„ìš”í•˜ì‹œë‹¤ë©´:\nâ€¢ ìì‚´ì˜ˆë°©ìƒë‹´ì „í™”: 1393 (24ì‹œê°„)\nâ€¢ ì •ì‹ ê±´ê°•ìœ„ê¸°ìƒë‹´: 1577-0199\nâ€¢ ìƒëª…ì˜ì „í™”: 1588-9191\n\nì „ë¬¸ê°€ì˜ ë„ì›€ì„ ë°›ìœ¼ì‹œê¸¸ ê°•ë ¥íˆ ê¶Œì¥í•©ë‹ˆë‹¤.";
      }
      
      // 2. í‚¤ì›Œë“œ ë§¤ì¹­
      let matchedCategories = [];
      for (const category in DATA.aiKeywordsByCategory) {
        const keywords = DATA.aiKeywordsByCategory[category];
        if (keywords.some(k => txt.includes(k))) {
          matchedCategories.push(category);
        }
      }
      
      // 3. ìš°ì„ ìˆœìœ„ë³„ ì‘ë‹µ
      const priority = ['stress', 'depression', 'insomnia', 'anxiety', 'fatigue', 'hunger', 'greeting', 'general'];
      const matched = priority.find(p => matchedCategories.includes(p));
      
      if (matched && DATA.aiResponses[matched]) {
        const response = DATA.aiResponses[matched];
        return `${response.empathy}\n\n${response.solution}`;
      }
      
      // 4. í˜„ì¬ ê¸°ë¶„ ê¸°ë°˜ ì»¨í…ìŠ¤íŠ¸ ì‘ë‹µ
      if (app.state.user) {
        const currentMood = localStorage.getItem(`mood_${app.state.user.id}`);
        if (currentMood === 'sad' || currentMood === 'tired' || currentMood === 'anxious') {
          return "ì§€ê¸ˆ ê¸°ë¶„ì´ ì¢‹ì§€ ì•Šìœ¼ì‹  ê²ƒ ê°™ì•„ ê±±ì •ë©ë‹ˆë‹¤. ğŸ˜”\n\nì–´ë–¤ ì¼ ë•Œë¬¸ì— ê·¸ëŸ¬ì‹ ì§€ ì²œì²œíˆ ì´ì•¼ê¸°í•´ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”? ì œê°€ ì˜†ì—ì„œ ì˜ ë“¤ì–´ë“œë¦´ê²Œìš”.\n\nê°„ë‹¨í•œ í˜¸í¡ë²•(4ì´ˆ ë“¤ì´ì‰¬ê³ , 7ì´ˆ ë©ˆì¶”ê³ , 8ì´ˆ ë‚´ì‰¬ê¸°)ì´ë‚˜ ì§§ì€ ì‚°ì±…ë„ ë„ì›€ì´ ë  ìˆ˜ ìˆì–´ìš”.";
        } else if (
